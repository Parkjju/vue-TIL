<!DOCTYPE html>
<html lang="ko-KR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Snack - [iOS] Kingfisher 네트워크 목업 테스트 | Today I Learned</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="shortcut icon" href="/vue-TIL/favicon.ico">
    <link rel="manifest" href="/vue-TIL/manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css">
    <link rel="apple-touch-icon" sizes="192x192" href="images/maskable_icon_x192.png">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-QP5LL1SE8Q"></script>
    <script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-QP5LL1SE8Q');</script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"Today I Learned","url":"https://parkjju.github.io/vue-TIL/","description":"기술 학습 노트 - Swift, iOS, 알고리즘, 웹 개발 등","author":{"@type":"Person","name":"Parkjju"},"publisher":{"@type":"Person","name":"Parkjju"},"inLanguage":"ko-KR"}</script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Blog","name":"Today I Learned","url":"https://parkjju.github.io/vue-TIL/","description":"기술 학습 노트 - Swift, iOS development, 알고리즘, React, VuePress 등 개발 관련 지식을 정리한 블로그","author":{"@type":"Person","name":"Parkjju"},"publisher":{"@type":"Person","name":"Parkjju"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://parkjju.github.io/vue-TIL/"},"potentialAction":{"@type":"ReadAction","target":"https://parkjju.github.io/vue-TIL/"}}</script>
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/vue-TIL/assets/css/0.styles.7142d2c3.css" as="style"><link rel="preload" href="/vue-TIL/assets/js/app.bfb5f89b.js" as="script"><link rel="preload" href="/vue-TIL/assets/js/2.f7b87a9b.js" as="script"><link rel="preload" href="/vue-TIL/assets/js/1.e7a4714f.js" as="script"><link rel="preload" href="/vue-TIL/assets/js/54.2ed0e211.js" as="script"><link rel="preload" href="/vue-TIL/assets/js/56.4fdfd0b1.js" as="script"><link rel="prefetch" href="/vue-TIL/assets/js/10.7641bc6c.js"><link rel="prefetch" href="/vue-TIL/assets/js/100.b11ebb8d.js"><link rel="prefetch" href="/vue-TIL/assets/js/101.960efd3e.js"><link rel="prefetch" href="/vue-TIL/assets/js/102.191fd5fd.js"><link rel="prefetch" href="/vue-TIL/assets/js/103.de1ecb91.js"><link rel="prefetch" href="/vue-TIL/assets/js/104.93e2bac0.js"><link rel="prefetch" href="/vue-TIL/assets/js/105.124f6cdf.js"><link rel="prefetch" href="/vue-TIL/assets/js/106.01271934.js"><link rel="prefetch" href="/vue-TIL/assets/js/107.86b54b1d.js"><link rel="prefetch" href="/vue-TIL/assets/js/108.e5ab82be.js"><link rel="prefetch" href="/vue-TIL/assets/js/109.dbe2786e.js"><link rel="prefetch" href="/vue-TIL/assets/js/11.29c03bee.js"><link rel="prefetch" href="/vue-TIL/assets/js/110.c09875bc.js"><link rel="prefetch" href="/vue-TIL/assets/js/111.5d18b4a4.js"><link rel="prefetch" href="/vue-TIL/assets/js/112.2c9d5e04.js"><link rel="prefetch" href="/vue-TIL/assets/js/113.e46731ff.js"><link rel="prefetch" href="/vue-TIL/assets/js/114.bba4ab20.js"><link rel="prefetch" href="/vue-TIL/assets/js/115.46e45e60.js"><link rel="prefetch" href="/vue-TIL/assets/js/116.9393895d.js"><link rel="prefetch" href="/vue-TIL/assets/js/117.fa749e51.js"><link rel="prefetch" href="/vue-TIL/assets/js/118.88eac9a8.js"><link rel="prefetch" href="/vue-TIL/assets/js/119.2c7b5bdf.js"><link rel="prefetch" href="/vue-TIL/assets/js/12.7d9a3073.js"><link rel="prefetch" href="/vue-TIL/assets/js/120.4f444f91.js"><link rel="prefetch" href="/vue-TIL/assets/js/121.3da0477c.js"><link rel="prefetch" href="/vue-TIL/assets/js/122.de94f623.js"><link rel="prefetch" href="/vue-TIL/assets/js/123.046ef4e5.js"><link rel="prefetch" href="/vue-TIL/assets/js/124.16986815.js"><link rel="prefetch" href="/vue-TIL/assets/js/125.4c7f32b0.js"><link rel="prefetch" href="/vue-TIL/assets/js/126.082f08b0.js"><link rel="prefetch" href="/vue-TIL/assets/js/127.589f7d65.js"><link rel="prefetch" href="/vue-TIL/assets/js/128.36358f8b.js"><link rel="prefetch" href="/vue-TIL/assets/js/129.8eb6d11b.js"><link rel="prefetch" href="/vue-TIL/assets/js/13.8695130a.js"><link rel="prefetch" href="/vue-TIL/assets/js/130.0324f9ed.js"><link rel="prefetch" href="/vue-TIL/assets/js/131.bb0a711b.js"><link rel="prefetch" href="/vue-TIL/assets/js/132.49d2da83.js"><link rel="prefetch" href="/vue-TIL/assets/js/133.cafed5a8.js"><link rel="prefetch" href="/vue-TIL/assets/js/134.6885736e.js"><link rel="prefetch" href="/vue-TIL/assets/js/135.a5b0c9ed.js"><link rel="prefetch" href="/vue-TIL/assets/js/136.2dd6d604.js"><link rel="prefetch" href="/vue-TIL/assets/js/137.0aa6299f.js"><link rel="prefetch" href="/vue-TIL/assets/js/138.6460fd9b.js"><link rel="prefetch" href="/vue-TIL/assets/js/139.29f76278.js"><link rel="prefetch" href="/vue-TIL/assets/js/14.9d533df1.js"><link rel="prefetch" href="/vue-TIL/assets/js/140.5f105f9f.js"><link rel="prefetch" href="/vue-TIL/assets/js/141.83f92318.js"><link rel="prefetch" href="/vue-TIL/assets/js/142.62f1e39c.js"><link rel="prefetch" href="/vue-TIL/assets/js/143.1fd6dfd0.js"><link rel="prefetch" href="/vue-TIL/assets/js/144.1721b3f6.js"><link rel="prefetch" href="/vue-TIL/assets/js/145.20319be2.js"><link rel="prefetch" href="/vue-TIL/assets/js/146.241c2e12.js"><link rel="prefetch" href="/vue-TIL/assets/js/147.be47d007.js"><link rel="prefetch" href="/vue-TIL/assets/js/148.a1fc42b1.js"><link rel="prefetch" href="/vue-TIL/assets/js/149.be6e3b1e.js"><link rel="prefetch" href="/vue-TIL/assets/js/15.24ed7070.js"><link rel="prefetch" href="/vue-TIL/assets/js/150.2341db4a.js"><link rel="prefetch" href="/vue-TIL/assets/js/151.89165953.js"><link rel="prefetch" href="/vue-TIL/assets/js/152.44aef2c6.js"><link rel="prefetch" href="/vue-TIL/assets/js/153.4e352e05.js"><link rel="prefetch" href="/vue-TIL/assets/js/154.16e282a9.js"><link rel="prefetch" href="/vue-TIL/assets/js/155.9df240b3.js"><link rel="prefetch" href="/vue-TIL/assets/js/156.0ef6fe40.js"><link rel="prefetch" href="/vue-TIL/assets/js/157.e5fd001c.js"><link rel="prefetch" href="/vue-TIL/assets/js/158.c0b4ff49.js"><link rel="prefetch" href="/vue-TIL/assets/js/159.8acf9c2e.js"><link rel="prefetch" href="/vue-TIL/assets/js/16.ccd2b7de.js"><link rel="prefetch" href="/vue-TIL/assets/js/160.8d4f5223.js"><link rel="prefetch" href="/vue-TIL/assets/js/161.3e4ee854.js"><link rel="prefetch" href="/vue-TIL/assets/js/162.cea62979.js"><link rel="prefetch" href="/vue-TIL/assets/js/163.31d17dcd.js"><link rel="prefetch" href="/vue-TIL/assets/js/164.90a48212.js"><link rel="prefetch" href="/vue-TIL/assets/js/165.1ade08cb.js"><link rel="prefetch" href="/vue-TIL/assets/js/166.c397c00e.js"><link rel="prefetch" href="/vue-TIL/assets/js/167.c0e9a413.js"><link rel="prefetch" href="/vue-TIL/assets/js/168.90fb652c.js"><link rel="prefetch" href="/vue-TIL/assets/js/169.a8751263.js"><link rel="prefetch" href="/vue-TIL/assets/js/17.24df42e0.js"><link rel="prefetch" href="/vue-TIL/assets/js/170.607fd02c.js"><link rel="prefetch" href="/vue-TIL/assets/js/171.a614dbbe.js"><link rel="prefetch" href="/vue-TIL/assets/js/172.2e310d26.js"><link rel="prefetch" href="/vue-TIL/assets/js/173.196603cb.js"><link rel="prefetch" href="/vue-TIL/assets/js/174.320f0bfa.js"><link rel="prefetch" href="/vue-TIL/assets/js/175.457763e2.js"><link rel="prefetch" href="/vue-TIL/assets/js/176.8ba9f09d.js"><link rel="prefetch" href="/vue-TIL/assets/js/177.4aa7badf.js"><link rel="prefetch" href="/vue-TIL/assets/js/178.9bae3260.js"><link rel="prefetch" href="/vue-TIL/assets/js/179.ea631234.js"><link rel="prefetch" href="/vue-TIL/assets/js/18.e8df9c9f.js"><link rel="prefetch" href="/vue-TIL/assets/js/180.fc439dda.js"><link rel="prefetch" href="/vue-TIL/assets/js/181.7ae9cba6.js"><link rel="prefetch" href="/vue-TIL/assets/js/182.f075628f.js"><link rel="prefetch" href="/vue-TIL/assets/js/183.f1112d0f.js"><link rel="prefetch" href="/vue-TIL/assets/js/184.3b587a7c.js"><link rel="prefetch" href="/vue-TIL/assets/js/185.e39bfb77.js"><link rel="prefetch" href="/vue-TIL/assets/js/186.a4d80e8c.js"><link rel="prefetch" href="/vue-TIL/assets/js/187.9a6e8db4.js"><link rel="prefetch" href="/vue-TIL/assets/js/188.c96a8682.js"><link rel="prefetch" href="/vue-TIL/assets/js/189.c981e3d4.js"><link rel="prefetch" href="/vue-TIL/assets/js/19.bbbaa940.js"><link rel="prefetch" href="/vue-TIL/assets/js/190.8cf55e2d.js"><link rel="prefetch" href="/vue-TIL/assets/js/191.a5c66a78.js"><link rel="prefetch" href="/vue-TIL/assets/js/192.9abc385c.js"><link rel="prefetch" href="/vue-TIL/assets/js/193.346694ea.js"><link rel="prefetch" href="/vue-TIL/assets/js/194.ad61cd5c.js"><link rel="prefetch" href="/vue-TIL/assets/js/195.18c3f8b3.js"><link rel="prefetch" href="/vue-TIL/assets/js/196.4477478e.js"><link rel="prefetch" href="/vue-TIL/assets/js/197.a9b75631.js"><link rel="prefetch" href="/vue-TIL/assets/js/198.de8e326d.js"><link rel="prefetch" href="/vue-TIL/assets/js/199.b8830e1d.js"><link rel="prefetch" href="/vue-TIL/assets/js/20.d5b28542.js"><link rel="prefetch" href="/vue-TIL/assets/js/200.c6c35fac.js"><link rel="prefetch" href="/vue-TIL/assets/js/201.63511230.js"><link rel="prefetch" href="/vue-TIL/assets/js/202.9a16f70b.js"><link rel="prefetch" href="/vue-TIL/assets/js/203.e55a745c.js"><link rel="prefetch" href="/vue-TIL/assets/js/204.8c0da54d.js"><link rel="prefetch" href="/vue-TIL/assets/js/205.4498cb99.js"><link rel="prefetch" href="/vue-TIL/assets/js/206.5fd5bae7.js"><link rel="prefetch" href="/vue-TIL/assets/js/207.2af90966.js"><link rel="prefetch" href="/vue-TIL/assets/js/208.252185a3.js"><link rel="prefetch" href="/vue-TIL/assets/js/209.713d8f18.js"><link rel="prefetch" href="/vue-TIL/assets/js/21.46a6ec6c.js"><link rel="prefetch" href="/vue-TIL/assets/js/210.bd4b6aa7.js"><link rel="prefetch" href="/vue-TIL/assets/js/211.b42b8b54.js"><link rel="prefetch" href="/vue-TIL/assets/js/212.c3ac33d1.js"><link rel="prefetch" href="/vue-TIL/assets/js/213.464c4da6.js"><link rel="prefetch" href="/vue-TIL/assets/js/214.ebdcbcd8.js"><link rel="prefetch" href="/vue-TIL/assets/js/215.8e6ec2ac.js"><link rel="prefetch" href="/vue-TIL/assets/js/216.b733bc47.js"><link rel="prefetch" href="/vue-TIL/assets/js/217.1dc74892.js"><link rel="prefetch" href="/vue-TIL/assets/js/218.071416a8.js"><link rel="prefetch" href="/vue-TIL/assets/js/219.3d78c341.js"><link rel="prefetch" href="/vue-TIL/assets/js/22.30836121.js"><link rel="prefetch" href="/vue-TIL/assets/js/220.4187ef50.js"><link rel="prefetch" href="/vue-TIL/assets/js/221.e529e3d5.js"><link rel="prefetch" href="/vue-TIL/assets/js/222.57497b63.js"><link rel="prefetch" href="/vue-TIL/assets/js/223.9b3afd60.js"><link rel="prefetch" href="/vue-TIL/assets/js/224.225ce294.js"><link rel="prefetch" href="/vue-TIL/assets/js/225.a20362bf.js"><link rel="prefetch" href="/vue-TIL/assets/js/226.ee66f0ff.js"><link rel="prefetch" href="/vue-TIL/assets/js/227.659309e7.js"><link rel="prefetch" href="/vue-TIL/assets/js/228.85e4f99e.js"><link rel="prefetch" href="/vue-TIL/assets/js/229.337c9b1a.js"><link rel="prefetch" href="/vue-TIL/assets/js/23.e0ddc1b4.js"><link rel="prefetch" href="/vue-TIL/assets/js/230.0b380345.js"><link rel="prefetch" href="/vue-TIL/assets/js/231.0c7a2569.js"><link rel="prefetch" href="/vue-TIL/assets/js/232.47b81df6.js"><link rel="prefetch" href="/vue-TIL/assets/js/233.4b0dec39.js"><link rel="prefetch" href="/vue-TIL/assets/js/234.8bae5012.js"><link rel="prefetch" href="/vue-TIL/assets/js/235.88981612.js"><link rel="prefetch" href="/vue-TIL/assets/js/236.f0b22e70.js"><link rel="prefetch" href="/vue-TIL/assets/js/237.9518d0c8.js"><link rel="prefetch" href="/vue-TIL/assets/js/238.fa373efe.js"><link rel="prefetch" href="/vue-TIL/assets/js/239.09ba19de.js"><link rel="prefetch" href="/vue-TIL/assets/js/24.7e85a684.js"><link rel="prefetch" href="/vue-TIL/assets/js/240.bb5eb579.js"><link rel="prefetch" href="/vue-TIL/assets/js/241.2f9fb5af.js"><link rel="prefetch" href="/vue-TIL/assets/js/242.e9ad8ddf.js"><link rel="prefetch" href="/vue-TIL/assets/js/243.bc9273f4.js"><link rel="prefetch" href="/vue-TIL/assets/js/244.62c66109.js"><link rel="prefetch" href="/vue-TIL/assets/js/245.880a2a74.js"><link rel="prefetch" href="/vue-TIL/assets/js/246.4af0a025.js"><link rel="prefetch" href="/vue-TIL/assets/js/247.541a030f.js"><link rel="prefetch" href="/vue-TIL/assets/js/248.a53ca6fa.js"><link rel="prefetch" href="/vue-TIL/assets/js/249.3ca8e689.js"><link rel="prefetch" href="/vue-TIL/assets/js/25.e7c2d2fa.js"><link rel="prefetch" href="/vue-TIL/assets/js/250.73b11a46.js"><link rel="prefetch" href="/vue-TIL/assets/js/251.c7251ceb.js"><link rel="prefetch" href="/vue-TIL/assets/js/252.1730f955.js"><link rel="prefetch" href="/vue-TIL/assets/js/253.1c0f6ef4.js"><link rel="prefetch" href="/vue-TIL/assets/js/254.5afda03b.js"><link rel="prefetch" href="/vue-TIL/assets/js/255.969965c6.js"><link rel="prefetch" href="/vue-TIL/assets/js/256.803ac8b9.js"><link rel="prefetch" href="/vue-TIL/assets/js/257.82cced49.js"><link rel="prefetch" href="/vue-TIL/assets/js/258.216534ec.js"><link rel="prefetch" href="/vue-TIL/assets/js/259.275da4e7.js"><link rel="prefetch" href="/vue-TIL/assets/js/26.5f2fa708.js"><link rel="prefetch" href="/vue-TIL/assets/js/260.e4d49c1d.js"><link rel="prefetch" href="/vue-TIL/assets/js/261.905898b4.js"><link rel="prefetch" href="/vue-TIL/assets/js/262.676f8c8b.js"><link rel="prefetch" href="/vue-TIL/assets/js/263.291c2270.js"><link rel="prefetch" href="/vue-TIL/assets/js/264.b3363962.js"><link rel="prefetch" href="/vue-TIL/assets/js/265.c579d238.js"><link rel="prefetch" href="/vue-TIL/assets/js/266.962b8f76.js"><link rel="prefetch" href="/vue-TIL/assets/js/267.77d8fb34.js"><link rel="prefetch" href="/vue-TIL/assets/js/268.5c8382c1.js"><link rel="prefetch" href="/vue-TIL/assets/js/269.ad4e908e.js"><link rel="prefetch" href="/vue-TIL/assets/js/27.cfad5670.js"><link rel="prefetch" href="/vue-TIL/assets/js/270.a37190a4.js"><link rel="prefetch" href="/vue-TIL/assets/js/271.d543be4b.js"><link rel="prefetch" href="/vue-TIL/assets/js/272.88a58d1b.js"><link rel="prefetch" href="/vue-TIL/assets/js/273.2ac1facf.js"><link rel="prefetch" href="/vue-TIL/assets/js/274.34fbeb95.js"><link rel="prefetch" href="/vue-TIL/assets/js/275.907b95a6.js"><link rel="prefetch" href="/vue-TIL/assets/js/276.9df88ada.js"><link rel="prefetch" href="/vue-TIL/assets/js/277.d7498205.js"><link rel="prefetch" href="/vue-TIL/assets/js/278.6a022344.js"><link rel="prefetch" href="/vue-TIL/assets/js/279.3377fd05.js"><link rel="prefetch" href="/vue-TIL/assets/js/28.4b9d12f8.js"><link rel="prefetch" href="/vue-TIL/assets/js/280.5297d372.js"><link rel="prefetch" href="/vue-TIL/assets/js/281.3264517b.js"><link rel="prefetch" href="/vue-TIL/assets/js/282.fa01abe6.js"><link rel="prefetch" href="/vue-TIL/assets/js/283.bbe931a2.js"><link rel="prefetch" href="/vue-TIL/assets/js/284.5aab5f2d.js"><link rel="prefetch" href="/vue-TIL/assets/js/285.8b6e7956.js"><link rel="prefetch" href="/vue-TIL/assets/js/286.f7b21b53.js"><link rel="prefetch" href="/vue-TIL/assets/js/287.4ab055e4.js"><link rel="prefetch" href="/vue-TIL/assets/js/288.64da397c.js"><link rel="prefetch" href="/vue-TIL/assets/js/289.13a31a31.js"><link rel="prefetch" href="/vue-TIL/assets/js/29.afc22aef.js"><link rel="prefetch" href="/vue-TIL/assets/js/290.8361f5ba.js"><link rel="prefetch" href="/vue-TIL/assets/js/291.0519c4c4.js"><link rel="prefetch" href="/vue-TIL/assets/js/292.18293aa8.js"><link rel="prefetch" href="/vue-TIL/assets/js/293.ad255a62.js"><link rel="prefetch" href="/vue-TIL/assets/js/294.e386a0ef.js"><link rel="prefetch" href="/vue-TIL/assets/js/295.6d801369.js"><link rel="prefetch" href="/vue-TIL/assets/js/296.e2210f96.js"><link rel="prefetch" href="/vue-TIL/assets/js/297.9b7b856c.js"><link rel="prefetch" href="/vue-TIL/assets/js/298.18233dfb.js"><link rel="prefetch" href="/vue-TIL/assets/js/299.e93ed4bb.js"><link rel="prefetch" href="/vue-TIL/assets/js/3.25c5bcbd.js"><link rel="prefetch" href="/vue-TIL/assets/js/30.12e83c20.js"><link rel="prefetch" href="/vue-TIL/assets/js/300.21b0326f.js"><link rel="prefetch" href="/vue-TIL/assets/js/301.f017a083.js"><link rel="prefetch" href="/vue-TIL/assets/js/302.af01676a.js"><link rel="prefetch" href="/vue-TIL/assets/js/303.f31ec8d0.js"><link rel="prefetch" href="/vue-TIL/assets/js/304.561df1ee.js"><link rel="prefetch" href="/vue-TIL/assets/js/305.edffb40d.js"><link rel="prefetch" href="/vue-TIL/assets/js/306.e01f0e24.js"><link rel="prefetch" href="/vue-TIL/assets/js/307.e33364d0.js"><link rel="prefetch" href="/vue-TIL/assets/js/308.f03a97ef.js"><link rel="prefetch" href="/vue-TIL/assets/js/309.38419bda.js"><link rel="prefetch" href="/vue-TIL/assets/js/31.56f0bb85.js"><link rel="prefetch" href="/vue-TIL/assets/js/310.aef66275.js"><link rel="prefetch" href="/vue-TIL/assets/js/311.c78192ef.js"><link rel="prefetch" href="/vue-TIL/assets/js/312.ec0cb731.js"><link rel="prefetch" href="/vue-TIL/assets/js/313.65292d25.js"><link rel="prefetch" href="/vue-TIL/assets/js/314.2f2e54bb.js"><link rel="prefetch" href="/vue-TIL/assets/js/315.c43eda04.js"><link rel="prefetch" href="/vue-TIL/assets/js/316.8788b857.js"><link rel="prefetch" href="/vue-TIL/assets/js/317.f66e1e1c.js"><link rel="prefetch" href="/vue-TIL/assets/js/318.821dea9e.js"><link rel="prefetch" href="/vue-TIL/assets/js/319.e6ad4539.js"><link rel="prefetch" href="/vue-TIL/assets/js/32.237ddf99.js"><link rel="prefetch" href="/vue-TIL/assets/js/320.4aa64fda.js"><link rel="prefetch" href="/vue-TIL/assets/js/321.2247a410.js"><link rel="prefetch" href="/vue-TIL/assets/js/322.e38dbdac.js"><link rel="prefetch" href="/vue-TIL/assets/js/323.e24909ae.js"><link rel="prefetch" href="/vue-TIL/assets/js/324.195b2f5b.js"><link rel="prefetch" href="/vue-TIL/assets/js/325.7b9d0f14.js"><link rel="prefetch" href="/vue-TIL/assets/js/326.8c950a5e.js"><link rel="prefetch" href="/vue-TIL/assets/js/327.b2177e62.js"><link rel="prefetch" href="/vue-TIL/assets/js/328.7ee29622.js"><link rel="prefetch" href="/vue-TIL/assets/js/329.c41817c7.js"><link rel="prefetch" href="/vue-TIL/assets/js/33.05e00e89.js"><link rel="prefetch" href="/vue-TIL/assets/js/330.6d4b1223.js"><link rel="prefetch" href="/vue-TIL/assets/js/331.e048c5c5.js"><link rel="prefetch" href="/vue-TIL/assets/js/332.971d5af6.js"><link rel="prefetch" href="/vue-TIL/assets/js/333.f40e6fb7.js"><link rel="prefetch" href="/vue-TIL/assets/js/334.436c515c.js"><link rel="prefetch" href="/vue-TIL/assets/js/335.9a30f2ca.js"><link rel="prefetch" href="/vue-TIL/assets/js/336.de4821ce.js"><link rel="prefetch" href="/vue-TIL/assets/js/337.cce7425a.js"><link rel="prefetch" href="/vue-TIL/assets/js/338.53f2abc1.js"><link rel="prefetch" href="/vue-TIL/assets/js/339.6ebf32fd.js"><link rel="prefetch" href="/vue-TIL/assets/js/34.1df4b9e1.js"><link rel="prefetch" href="/vue-TIL/assets/js/340.f30b6425.js"><link rel="prefetch" href="/vue-TIL/assets/js/341.b33bf208.js"><link rel="prefetch" href="/vue-TIL/assets/js/342.1ad1f686.js"><link rel="prefetch" href="/vue-TIL/assets/js/343.55efa688.js"><link rel="prefetch" href="/vue-TIL/assets/js/344.966814f6.js"><link rel="prefetch" href="/vue-TIL/assets/js/345.d27d901d.js"><link rel="prefetch" href="/vue-TIL/assets/js/346.bfe8097c.js"><link rel="prefetch" href="/vue-TIL/assets/js/347.02098a19.js"><link rel="prefetch" href="/vue-TIL/assets/js/348.8aaee166.js"><link rel="prefetch" href="/vue-TIL/assets/js/349.c53aa283.js"><link rel="prefetch" href="/vue-TIL/assets/js/35.2ef96099.js"><link rel="prefetch" href="/vue-TIL/assets/js/350.b3458338.js"><link rel="prefetch" href="/vue-TIL/assets/js/351.672b20d3.js"><link rel="prefetch" href="/vue-TIL/assets/js/352.ae42ef6d.js"><link rel="prefetch" href="/vue-TIL/assets/js/353.79e5a35b.js"><link rel="prefetch" href="/vue-TIL/assets/js/354.26108d1b.js"><link rel="prefetch" href="/vue-TIL/assets/js/355.152f1d5e.js"><link rel="prefetch" href="/vue-TIL/assets/js/356.e89e7ef5.js"><link rel="prefetch" href="/vue-TIL/assets/js/357.fe6c7454.js"><link rel="prefetch" href="/vue-TIL/assets/js/358.e5ec94ae.js"><link rel="prefetch" href="/vue-TIL/assets/js/359.ae0cc4f0.js"><link rel="prefetch" href="/vue-TIL/assets/js/36.f354ef1c.js"><link rel="prefetch" href="/vue-TIL/assets/js/360.b3821b93.js"><link rel="prefetch" href="/vue-TIL/assets/js/361.d685e0c7.js"><link rel="prefetch" href="/vue-TIL/assets/js/362.69209c9e.js"><link rel="prefetch" href="/vue-TIL/assets/js/363.f867f107.js"><link rel="prefetch" href="/vue-TIL/assets/js/364.6b40e4dd.js"><link rel="prefetch" href="/vue-TIL/assets/js/365.f625e235.js"><link rel="prefetch" href="/vue-TIL/assets/js/366.805b3d47.js"><link rel="prefetch" href="/vue-TIL/assets/js/367.b8c5ff4a.js"><link rel="prefetch" href="/vue-TIL/assets/js/368.589966a8.js"><link rel="prefetch" href="/vue-TIL/assets/js/369.803d664b.js"><link rel="prefetch" href="/vue-TIL/assets/js/37.f1ff1c2c.js"><link rel="prefetch" href="/vue-TIL/assets/js/370.8f7ef76f.js"><link rel="prefetch" href="/vue-TIL/assets/js/371.2d1f946b.js"><link rel="prefetch" href="/vue-TIL/assets/js/372.377fd2fb.js"><link rel="prefetch" href="/vue-TIL/assets/js/373.2c0dcc40.js"><link rel="prefetch" href="/vue-TIL/assets/js/374.18a698ca.js"><link rel="prefetch" href="/vue-TIL/assets/js/375.aae5e906.js"><link rel="prefetch" href="/vue-TIL/assets/js/376.3235fd3b.js"><link rel="prefetch" href="/vue-TIL/assets/js/377.dff98002.js"><link rel="prefetch" href="/vue-TIL/assets/js/378.809e2c14.js"><link rel="prefetch" href="/vue-TIL/assets/js/379.1b5081e7.js"><link rel="prefetch" href="/vue-TIL/assets/js/38.df70f573.js"><link rel="prefetch" href="/vue-TIL/assets/js/380.5a1f098f.js"><link rel="prefetch" href="/vue-TIL/assets/js/381.450daf89.js"><link rel="prefetch" href="/vue-TIL/assets/js/382.ed4dcf75.js"><link rel="prefetch" href="/vue-TIL/assets/js/383.20f7061f.js"><link rel="prefetch" href="/vue-TIL/assets/js/384.bd70a547.js"><link rel="prefetch" href="/vue-TIL/assets/js/385.ac34d69e.js"><link rel="prefetch" href="/vue-TIL/assets/js/386.966ab71c.js"><link rel="prefetch" href="/vue-TIL/assets/js/387.1d1c498d.js"><link rel="prefetch" href="/vue-TIL/assets/js/388.70f9e9f4.js"><link rel="prefetch" href="/vue-TIL/assets/js/389.0e868a4d.js"><link rel="prefetch" href="/vue-TIL/assets/js/39.b60cac0e.js"><link rel="prefetch" href="/vue-TIL/assets/js/390.4db537b9.js"><link rel="prefetch" href="/vue-TIL/assets/js/391.cc953f37.js"><link rel="prefetch" href="/vue-TIL/assets/js/392.80d2c766.js"><link rel="prefetch" href="/vue-TIL/assets/js/393.83962a81.js"><link rel="prefetch" href="/vue-TIL/assets/js/394.f1aa2148.js"><link rel="prefetch" href="/vue-TIL/assets/js/395.4b289799.js"><link rel="prefetch" href="/vue-TIL/assets/js/396.f65304e3.js"><link rel="prefetch" href="/vue-TIL/assets/js/397.de3e0da4.js"><link rel="prefetch" href="/vue-TIL/assets/js/398.b51111ba.js"><link rel="prefetch" href="/vue-TIL/assets/js/399.f63fbae1.js"><link rel="prefetch" href="/vue-TIL/assets/js/4.25e71b75.js"><link rel="prefetch" href="/vue-TIL/assets/js/40.6ecf0f1f.js"><link rel="prefetch" href="/vue-TIL/assets/js/400.5bb78834.js"><link rel="prefetch" href="/vue-TIL/assets/js/401.867a6e66.js"><link rel="prefetch" href="/vue-TIL/assets/js/402.be5366b4.js"><link rel="prefetch" href="/vue-TIL/assets/js/403.b4530ebc.js"><link rel="prefetch" href="/vue-TIL/assets/js/404.e73d17d8.js"><link rel="prefetch" href="/vue-TIL/assets/js/405.3ab8563b.js"><link rel="prefetch" href="/vue-TIL/assets/js/406.d9d1e9b6.js"><link rel="prefetch" href="/vue-TIL/assets/js/407.32531d0d.js"><link rel="prefetch" href="/vue-TIL/assets/js/408.b825566a.js"><link rel="prefetch" href="/vue-TIL/assets/js/409.849e1fc8.js"><link rel="prefetch" href="/vue-TIL/assets/js/41.82a9e9fe.js"><link rel="prefetch" href="/vue-TIL/assets/js/410.42a929d0.js"><link rel="prefetch" href="/vue-TIL/assets/js/411.5ca41c82.js"><link rel="prefetch" href="/vue-TIL/assets/js/412.d180d104.js"><link rel="prefetch" href="/vue-TIL/assets/js/413.a1d84df9.js"><link rel="prefetch" href="/vue-TIL/assets/js/414.2caec428.js"><link rel="prefetch" href="/vue-TIL/assets/js/415.8ad7e83a.js"><link rel="prefetch" href="/vue-TIL/assets/js/416.0728dd58.js"><link rel="prefetch" href="/vue-TIL/assets/js/417.c62fb6ad.js"><link rel="prefetch" href="/vue-TIL/assets/js/418.404368af.js"><link rel="prefetch" href="/vue-TIL/assets/js/419.77193b90.js"><link rel="prefetch" href="/vue-TIL/assets/js/42.1fc5b4af.js"><link rel="prefetch" href="/vue-TIL/assets/js/420.b3448887.js"><link rel="prefetch" href="/vue-TIL/assets/js/421.51410262.js"><link rel="prefetch" href="/vue-TIL/assets/js/422.ee0ffb6f.js"><link rel="prefetch" href="/vue-TIL/assets/js/423.8ec884fd.js"><link rel="prefetch" href="/vue-TIL/assets/js/424.bc6ad318.js"><link rel="prefetch" href="/vue-TIL/assets/js/425.fc650704.js"><link rel="prefetch" href="/vue-TIL/assets/js/426.dd88ffdc.js"><link rel="prefetch" href="/vue-TIL/assets/js/427.a15c3bb1.js"><link rel="prefetch" href="/vue-TIL/assets/js/428.4b3ddb1c.js"><link rel="prefetch" href="/vue-TIL/assets/js/429.906577b4.js"><link rel="prefetch" href="/vue-TIL/assets/js/43.f4ce1a8b.js"><link rel="prefetch" href="/vue-TIL/assets/js/430.f2f70921.js"><link rel="prefetch" href="/vue-TIL/assets/js/431.5d48412a.js"><link rel="prefetch" href="/vue-TIL/assets/js/432.81e93bcb.js"><link rel="prefetch" href="/vue-TIL/assets/js/433.fe77598a.js"><link rel="prefetch" href="/vue-TIL/assets/js/434.603cc810.js"><link rel="prefetch" href="/vue-TIL/assets/js/435.2503b4d2.js"><link rel="prefetch" href="/vue-TIL/assets/js/436.ac5534a3.js"><link rel="prefetch" href="/vue-TIL/assets/js/437.36fd95f0.js"><link rel="prefetch" href="/vue-TIL/assets/js/438.242bb0a1.js"><link rel="prefetch" href="/vue-TIL/assets/js/439.0e2a2d19.js"><link rel="prefetch" href="/vue-TIL/assets/js/44.fe07a6e8.js"><link rel="prefetch" href="/vue-TIL/assets/js/440.31e97207.js"><link rel="prefetch" href="/vue-TIL/assets/js/441.b82d7714.js"><link rel="prefetch" href="/vue-TIL/assets/js/442.c9291ea7.js"><link rel="prefetch" href="/vue-TIL/assets/js/443.62956454.js"><link rel="prefetch" href="/vue-TIL/assets/js/444.303bd4ae.js"><link rel="prefetch" href="/vue-TIL/assets/js/445.5ec160e7.js"><link rel="prefetch" href="/vue-TIL/assets/js/446.03a4414a.js"><link rel="prefetch" href="/vue-TIL/assets/js/447.07d03b27.js"><link rel="prefetch" href="/vue-TIL/assets/js/448.0992c596.js"><link rel="prefetch" href="/vue-TIL/assets/js/449.3a43d191.js"><link rel="prefetch" href="/vue-TIL/assets/js/45.369d85b1.js"><link rel="prefetch" href="/vue-TIL/assets/js/450.9ec9f40b.js"><link rel="prefetch" href="/vue-TIL/assets/js/451.90da3dfc.js"><link rel="prefetch" href="/vue-TIL/assets/js/452.a0e8b682.js"><link rel="prefetch" href="/vue-TIL/assets/js/453.92d361be.js"><link rel="prefetch" href="/vue-TIL/assets/js/454.96d1f99c.js"><link rel="prefetch" href="/vue-TIL/assets/js/455.4ebb1010.js"><link rel="prefetch" href="/vue-TIL/assets/js/456.b967b26d.js"><link rel="prefetch" href="/vue-TIL/assets/js/457.67ab0cc9.js"><link rel="prefetch" href="/vue-TIL/assets/js/458.24e42d66.js"><link rel="prefetch" href="/vue-TIL/assets/js/459.a890caf6.js"><link rel="prefetch" href="/vue-TIL/assets/js/46.da8d2115.js"><link rel="prefetch" href="/vue-TIL/assets/js/460.6342fced.js"><link rel="prefetch" href="/vue-TIL/assets/js/461.404f3765.js"><link rel="prefetch" href="/vue-TIL/assets/js/462.86ba5bc0.js"><link rel="prefetch" href="/vue-TIL/assets/js/463.6a432d4a.js"><link rel="prefetch" href="/vue-TIL/assets/js/464.623e7318.js"><link rel="prefetch" href="/vue-TIL/assets/js/465.9e1714a0.js"><link rel="prefetch" href="/vue-TIL/assets/js/466.97c7700c.js"><link rel="prefetch" href="/vue-TIL/assets/js/467.80b8098f.js"><link rel="prefetch" href="/vue-TIL/assets/js/468.7b4c9274.js"><link rel="prefetch" href="/vue-TIL/assets/js/469.83e716bb.js"><link rel="prefetch" href="/vue-TIL/assets/js/47.b048b93b.js"><link rel="prefetch" href="/vue-TIL/assets/js/470.5abbb8cd.js"><link rel="prefetch" href="/vue-TIL/assets/js/471.fa7aa732.js"><link rel="prefetch" href="/vue-TIL/assets/js/472.8fd79798.js"><link rel="prefetch" href="/vue-TIL/assets/js/473.cfe649fc.js"><link rel="prefetch" href="/vue-TIL/assets/js/474.140eea78.js"><link rel="prefetch" href="/vue-TIL/assets/js/475.612ba1b5.js"><link rel="prefetch" href="/vue-TIL/assets/js/476.cbf97858.js"><link rel="prefetch" href="/vue-TIL/assets/js/477.f044f51b.js"><link rel="prefetch" href="/vue-TIL/assets/js/478.2ad2d873.js"><link rel="prefetch" href="/vue-TIL/assets/js/479.71c0cf9a.js"><link rel="prefetch" href="/vue-TIL/assets/js/48.8f91719e.js"><link rel="prefetch" href="/vue-TIL/assets/js/480.c219e39f.js"><link rel="prefetch" href="/vue-TIL/assets/js/481.07e617fc.js"><link rel="prefetch" href="/vue-TIL/assets/js/482.27188cce.js"><link rel="prefetch" href="/vue-TIL/assets/js/483.f840ae4b.js"><link rel="prefetch" href="/vue-TIL/assets/js/484.e4582992.js"><link rel="prefetch" href="/vue-TIL/assets/js/485.aba3a3d4.js"><link rel="prefetch" href="/vue-TIL/assets/js/486.8aa282a3.js"><link rel="prefetch" href="/vue-TIL/assets/js/487.875b9e6b.js"><link rel="prefetch" href="/vue-TIL/assets/js/488.105c0f7e.js"><link rel="prefetch" href="/vue-TIL/assets/js/489.40d986e5.js"><link rel="prefetch" href="/vue-TIL/assets/js/49.f2d9eb55.js"><link rel="prefetch" href="/vue-TIL/assets/js/490.721b6397.js"><link rel="prefetch" href="/vue-TIL/assets/js/491.bd6a8485.js"><link rel="prefetch" href="/vue-TIL/assets/js/492.c223b1e8.js"><link rel="prefetch" href="/vue-TIL/assets/js/493.2f646526.js"><link rel="prefetch" href="/vue-TIL/assets/js/494.bbe775b4.js"><link rel="prefetch" href="/vue-TIL/assets/js/495.3aedb1de.js"><link rel="prefetch" href="/vue-TIL/assets/js/496.004304d2.js"><link rel="prefetch" href="/vue-TIL/assets/js/497.05c2acaf.js"><link rel="prefetch" href="/vue-TIL/assets/js/498.db7af06e.js"><link rel="prefetch" href="/vue-TIL/assets/js/499.f1786872.js"><link rel="prefetch" href="/vue-TIL/assets/js/5.c09c6248.js"><link rel="prefetch" href="/vue-TIL/assets/js/50.3ff3d901.js"><link rel="prefetch" href="/vue-TIL/assets/js/500.df8b78de.js"><link rel="prefetch" href="/vue-TIL/assets/js/501.5d9f7931.js"><link rel="prefetch" href="/vue-TIL/assets/js/502.033f38b5.js"><link rel="prefetch" href="/vue-TIL/assets/js/503.9c974e33.js"><link rel="prefetch" href="/vue-TIL/assets/js/504.aea3af4a.js"><link rel="prefetch" href="/vue-TIL/assets/js/505.8a4725fe.js"><link rel="prefetch" href="/vue-TIL/assets/js/506.6793bb92.js"><link rel="prefetch" href="/vue-TIL/assets/js/507.0a6fae5e.js"><link rel="prefetch" href="/vue-TIL/assets/js/508.f831c6ee.js"><link rel="prefetch" href="/vue-TIL/assets/js/509.5d4359e2.js"><link rel="prefetch" href="/vue-TIL/assets/js/51.cbc6a2ff.js"><link rel="prefetch" href="/vue-TIL/assets/js/510.79a73e56.js"><link rel="prefetch" href="/vue-TIL/assets/js/511.33344fc4.js"><link rel="prefetch" href="/vue-TIL/assets/js/512.b97db89d.js"><link rel="prefetch" href="/vue-TIL/assets/js/513.1171625d.js"><link rel="prefetch" href="/vue-TIL/assets/js/514.ed25935a.js"><link rel="prefetch" href="/vue-TIL/assets/js/515.addb99b8.js"><link rel="prefetch" href="/vue-TIL/assets/js/516.7931ab4a.js"><link rel="prefetch" href="/vue-TIL/assets/js/517.f35a9539.js"><link rel="prefetch" href="/vue-TIL/assets/js/518.67ed80d5.js"><link rel="prefetch" href="/vue-TIL/assets/js/519.dd0e837b.js"><link rel="prefetch" href="/vue-TIL/assets/js/52.4bbcac1c.js"><link rel="prefetch" href="/vue-TIL/assets/js/520.d5fe1d95.js"><link rel="prefetch" href="/vue-TIL/assets/js/521.b948ee14.js"><link rel="prefetch" href="/vue-TIL/assets/js/522.abe595ae.js"><link rel="prefetch" href="/vue-TIL/assets/js/523.b2343435.js"><link rel="prefetch" href="/vue-TIL/assets/js/524.568bf094.js"><link rel="prefetch" href="/vue-TIL/assets/js/525.541408ed.js"><link rel="prefetch" href="/vue-TIL/assets/js/526.8b4692d6.js"><link rel="prefetch" href="/vue-TIL/assets/js/527.424271e9.js"><link rel="prefetch" href="/vue-TIL/assets/js/528.b7428b32.js"><link rel="prefetch" href="/vue-TIL/assets/js/529.bb616278.js"><link rel="prefetch" href="/vue-TIL/assets/js/53.1474b7ad.js"><link rel="prefetch" href="/vue-TIL/assets/js/530.b384829e.js"><link rel="prefetch" href="/vue-TIL/assets/js/531.97eadf38.js"><link rel="prefetch" href="/vue-TIL/assets/js/532.b0927e60.js"><link rel="prefetch" href="/vue-TIL/assets/js/533.417134fc.js"><link rel="prefetch" href="/vue-TIL/assets/js/534.8c1b255d.js"><link rel="prefetch" href="/vue-TIL/assets/js/535.0fa2c86f.js"><link rel="prefetch" href="/vue-TIL/assets/js/536.05ba1514.js"><link rel="prefetch" href="/vue-TIL/assets/js/537.e0da5180.js"><link rel="prefetch" href="/vue-TIL/assets/js/538.94cc8c4b.js"><link rel="prefetch" href="/vue-TIL/assets/js/539.7f1ee168.js"><link rel="prefetch" href="/vue-TIL/assets/js/55.affd020f.js"><link rel="prefetch" href="/vue-TIL/assets/js/57.f89f20c9.js"><link rel="prefetch" href="/vue-TIL/assets/js/58.8f844c64.js"><link rel="prefetch" href="/vue-TIL/assets/js/59.cdbb2209.js"><link rel="prefetch" href="/vue-TIL/assets/js/6.cdb7e85f.js"><link rel="prefetch" href="/vue-TIL/assets/js/60.d7351cf5.js"><link rel="prefetch" href="/vue-TIL/assets/js/61.24497aee.js"><link rel="prefetch" href="/vue-TIL/assets/js/62.1735a944.js"><link rel="prefetch" href="/vue-TIL/assets/js/63.039f71d7.js"><link rel="prefetch" href="/vue-TIL/assets/js/64.916198cd.js"><link rel="prefetch" href="/vue-TIL/assets/js/65.da55d78b.js"><link rel="prefetch" href="/vue-TIL/assets/js/66.6324ee8e.js"><link rel="prefetch" href="/vue-TIL/assets/js/67.0a40b967.js"><link rel="prefetch" href="/vue-TIL/assets/js/68.76991e6d.js"><link rel="prefetch" href="/vue-TIL/assets/js/69.936a83ee.js"><link rel="prefetch" href="/vue-TIL/assets/js/7.0d37580c.js"><link rel="prefetch" href="/vue-TIL/assets/js/70.7ee002c2.js"><link rel="prefetch" href="/vue-TIL/assets/js/71.7a5e9ea1.js"><link rel="prefetch" href="/vue-TIL/assets/js/72.eb5f786f.js"><link rel="prefetch" href="/vue-TIL/assets/js/73.d73c98f9.js"><link rel="prefetch" href="/vue-TIL/assets/js/74.b364d5a1.js"><link rel="prefetch" href="/vue-TIL/assets/js/75.7b067ff9.js"><link rel="prefetch" href="/vue-TIL/assets/js/76.6d415f59.js"><link rel="prefetch" href="/vue-TIL/assets/js/77.b51d2841.js"><link rel="prefetch" href="/vue-TIL/assets/js/78.8b580a0d.js"><link rel="prefetch" href="/vue-TIL/assets/js/79.2532bc66.js"><link rel="prefetch" href="/vue-TIL/assets/js/80.72eca482.js"><link rel="prefetch" href="/vue-TIL/assets/js/81.e9ad012f.js"><link rel="prefetch" href="/vue-TIL/assets/js/82.56b4ccf3.js"><link rel="prefetch" href="/vue-TIL/assets/js/83.8bf9861a.js"><link rel="prefetch" href="/vue-TIL/assets/js/84.56c3e00e.js"><link rel="prefetch" href="/vue-TIL/assets/js/85.fcddad39.js"><link rel="prefetch" href="/vue-TIL/assets/js/86.d019b801.js"><link rel="prefetch" href="/vue-TIL/assets/js/87.04409673.js"><link rel="prefetch" href="/vue-TIL/assets/js/88.8d64bb44.js"><link rel="prefetch" href="/vue-TIL/assets/js/89.e98d2e14.js"><link rel="prefetch" href="/vue-TIL/assets/js/90.a3498475.js"><link rel="prefetch" href="/vue-TIL/assets/js/91.28b94a4f.js"><link rel="prefetch" href="/vue-TIL/assets/js/92.2c91daf5.js"><link rel="prefetch" href="/vue-TIL/assets/js/93.5c28cf64.js"><link rel="prefetch" href="/vue-TIL/assets/js/94.d455ab28.js"><link rel="prefetch" href="/vue-TIL/assets/js/95.632401f1.js"><link rel="prefetch" href="/vue-TIL/assets/js/96.35dd3023.js"><link rel="prefetch" href="/vue-TIL/assets/js/97.e45a4317.js"><link rel="prefetch" href="/vue-TIL/assets/js/98.ff9cf268.js"><link rel="prefetch" href="/vue-TIL/assets/js/99.49d71fde.js"><link rel="prefetch" href="/vue-TIL/assets/js/vendors~docsearch.79944109.js">
    <link rel="stylesheet" href="/vue-TIL/assets/css/0.styles.7142d2c3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vue-TIL/" class="home-link router-link-active"><!----> <span class="site-name">Today I Learned</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vue-TIL/trash/introduction.html" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/vue-TIL/archive.html" class="nav-link">
  Archive
</a></div> <a href="https://github.com/Parkjju/vue-TIL" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vue-TIL/trash/introduction.html" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/vue-TIL/archive.html" class="nav-link">
  Archive
</a></div> <a href="https://github.com/Parkjju/vue-TIL" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Snack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-TIL/trash/240614-47.html" class="sidebar-link">Snack - [iOS] Kingfisher를 통한 캐시 성능 향상 확인해보기</a></li><li><a href="/vue-TIL/trash/231019-33.html" class="sidebar-link">Snack - [iOS] Alamofire 401 중복 호출문제 개선</a></li><li><a href="/vue-TIL/trash/230319-19.html" class="sidebar-link">Snack - [iOS] 테이블뷰 인덱싱 (feat. 한글 유니코드)</a></li><li><a href="/vue-TIL/trash/240613-46.html" class="sidebar-link">Snack - [iOS] 반응형으로 UX 개선하기</a></li><li><a href="/vue-TIL/trash/230512-27.html" class="sidebar-link">Snack - [iOS] Swift 이미지 확대 및 리사이징, 움직이기 (UIPinchGestureRecognizer, UIPanGestureRecognizer), CGAffineTransform 사용법</a></li><li><a href="/vue-TIL/trash/231123-34.html" class="sidebar-link">Snack - [iOS] 킹피셔 이미지 캐싱 기반의 핀터레스트 레이아웃 구현 + RxSwift</a></li><li><a href="/vue-TIL/trash/231125-35.html" class="sidebar-link">Snack - [iOS] RxDataSource 컬렉션뷰 헤더 SupplementaryView</a></li><li><a href="/vue-TIL/trash/231205-39.html" aria-current="page" class="active sidebar-link">Snack - [iOS] Kingfisher 네트워크 목업 테스트</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue-TIL/trash/231205-39.html#이미지-캐싱과-외부환경-의존성" class="sidebar-link">이미지 캐싱과 외부환경 의존성</a></li><li class="sidebar-sub-header"><a href="/vue-TIL/trash/231205-39.html#retrievecacheobservable-함수에-대한-이해" class="sidebar-link">retrieveCacheObservable 함수에 대한 이해</a></li><li class="sidebar-sub-header"><a href="/vue-TIL/trash/231205-39.html#킹피셔-options-둘러보기" class="sidebar-link">킹피셔 options 둘러보기</a></li><li class="sidebar-sub-header"><a href="/vue-TIL/trash/231205-39.html#테스트-코드-작성" class="sidebar-link">테스트 코드 작성</a></li><li class="sidebar-sub-header"><a href="/vue-TIL/trash/231205-39.html#테스트-실행-결과" class="sidebar-link">테스트 실행 결과</a></li><li class="sidebar-sub-header"><a href="/vue-TIL/trash/231205-39.html#reference" class="sidebar-link">Reference</a></li></ul></li><li><a href="/vue-TIL/trash/240416-45.html" class="sidebar-link">Snack - [iOS] UIPageViewController에 코디네이터 패턴 적용하기</a></li><li><a href="/vue-TIL/trash/230918-31.html" class="sidebar-link">Snack - [iOS] RxSwift Input &amp; Output</a></li><li><a href="/vue-TIL/trash/250521-mcp.html" class="sidebar-link">Snack - [iOS] MCP 서버 구축하기</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>프로젝트 포즈피커 개발 이야기입니다! 궁금하시다면 놀러와주세요 😃 <a href="https://apps.apple.com/kr/app/%ED%8F%AC%EC%A6%88%ED%94%BC%EC%BB%A4-%EB%84%A4%EC%BB%B7%EC%82%AC%EC%A7%84-%ED%8F%AC%EC%A6%88%EC%B6%94%EC%B2%9C/id6474260471" target="_blank" rel="noopener noreferrer">[포즈피커 다운받기🔗]<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h1 id="들어가며"><a href="#들어가며" class="header-anchor">#</a> 들어가며</h1> <p>이 글은 <code>RxTest</code>기반의 테스트 코드 작성과 관련된 글입니다. 다음 글들을 먼저 읽고 오시면 아래에 이어질 글을 이해하는 데에 더 큰 도움이 됩니다.</p> <ol><li><a href="https://parkjju.github.io/vue-TIL/trash/230918-32.html" target="_blank" rel="noopener noreferrer">유닛 테스트 환경 구축<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://parkjju.github.io/vue-TIL/trash/231129-37.html" target="_blank" rel="noopener noreferrer">RxBlocking, RxTest로 테스트코드 작성하기<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://parkjju.github.io/vue-TIL/trash/231202-38.html" target="_blank" rel="noopener noreferrer">네트워크 목업 테스트<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <div class="custom-block tip"><p class="custom-block-title">필요한 사전지식</p> <ol><li><code>RxSwift</code></li> <li><code>Kingfisher</code></li> <li>유닛 테스트에 대한 이해</li></ol></div> <h2 id="이미지-캐싱과-외부환경-의존성"><a href="#이미지-캐싱과-외부환경-의존성" class="header-anchor">#</a> 이미지 캐싱과 외부환경 의존성</h2> <p>테스트 코드 작성에 있어 가장 중요한 대전제는 <strong>외부 환경에 의존해서는 안된다는 것이다.</strong></p> <p>Kingfisher 라이브러리는 메모리에 이미지들을 캐싱하여 컬렉션뷰와 같이 빠른 속도로 컨텐츠 로딩이 필요한 뷰 구성에 많은 도움을 준다. 아래 화면을 잠깐 확인해보자.</p> <p><img src="/vue-TIL/assets/img/39-1.8c6a0fb5.gif" alt="39-1"></p> <p>위 화면을 구현하는 데에 작성된 코드 흐름은 다음과 같다.</p> <ol><li>포즈피드 메뉴 이동과 동시에 피드 초기 데이터 로딩 (API 요청)</li> <li>스크롤이 끝에 닿았을때 다음 페이지 데이터 요청</li></ol> <p>이때 API 요청을 통해 불러온 JSON 데이터 일부를 보면 아래와 같다.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;poseInfo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;createdAt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2023-09-24T20:07:07.44874&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;updatedAt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2023-09-24T23:27:53.504153&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;imageKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://AmazonS3 URL/이미지명.jpg&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;poseId&quot;</span><span class="token operator">:</span> <span class="token number">325</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;poseInfo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;createdAt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2023-09-24T20:09:52.465325&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;updatedAt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2023-09-24T20:09:52.465325&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;imageKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://AmazonS3 URL/이미지명.jpg&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;poseId&quot;</span><span class="token operator">:</span> <span class="token number">327</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// ....</span>
<span class="token punctuation">]</span>
</code></pre></div><p>위의 데이터 속성값 중 <code>imageKey</code>가 아마존 S3에서 넘겨받은 이미지 URL이다. 이미지 데이터를 직접 넘겨주지 않고 위와 같이 이미지 URL을 클라이언트에 넘겨주면 직접 다운로드 받는 방식으로 구현하는 것이 일반적이다.</p> <p>이때 이미지를 다운로드 한다는 점에서 클라이언트 자체 리소스를 사용한다는 부분이 중요하다. 컬렉션뷰 구성 시 스크롤이 되면서 기존 셀들을 재사용하는 형태로 내부가 구현되는데 기존 이미지를 초기화하면 동일한 셀 위치로 스크롤이 다시 이루어져 해당 셀을 표기하고자 할때 <strong>전에 다운로드 했던 이미지를 또 다시 다운로드 받아야 한다는 점이 큰 문제이다.</strong></p> <p>킹피셔 라이브러리는 이러한 문제를 쉽게 관리할 수 있게끔 캐시 CRUD에 대한 접근성을 쉽게 추상화 해두었다.</p> <p>위 화면 구현에 사용된 코드의 일부를 보면 다음과 같다.</p> <div class="language-swift extra-class"><pre class="language-swift"><code>input<span class="token punctuation">.</span>requestAllPoseTrigger
    <span class="token punctuation">.</span>flatMapLatest <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token keyword">unowned</span> <span class="token keyword">self</span><span class="token punctuation">]</span> <span class="token omit keyword">_</span> <span class="token operator">-&gt;</span> <span class="token class-name">Observable</span><span class="token operator">&lt;</span><span class="token class-name">PoseFeed</span><span class="token operator">&gt;</span> <span class="token keyword">in</span>
        loadable<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>apiSession<span class="token punctuation">.</span><span class="token function">requestSingle</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">retrieveAllPoseFeed</span><span class="token punctuation">(</span>pageNumber<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>currentPage<span class="token punctuation">,</span> pageSize<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>content <span class="token punctuation">}</span>
    <span class="token punctuation">.</span>flatMapLatest <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token keyword">unowned</span> <span class="token keyword">self</span><span class="token punctuation">]</span> posefeed <span class="token operator">-&gt;</span> <span class="token class-name">Observable</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">PoseFeedPhotoCellViewModel</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">in</span>
        <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">retrieveCacheObservable</span><span class="token punctuation">(</span>posefeed<span class="token punctuation">:</span> posefeed<span class="token punctuation">)</span> <span class="token comment">// 이미지 캐싱!</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>onNext<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        loadable<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
        filterSection<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">disposed</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> disposeBag<span class="token punctuation">)</span>
</code></pre></div><ol><li><code>viewDidLoad</code> 시점에 퍼블리시 서브젝트로 <code>requestAllPoseTrigger</code>를 트리거 하여 API 요청을 진행한다.</li> <li>로드된 객체의 <code>content</code> 속성에 접근하여 배열을 순회하며 <code>imageKey</code>값을 기준으로 이미지 캐싱 로직을 실행한다.</li> <li>불러온 이미지를 기준으로 컬렉션뷰 셀 뷰모델을 <code>BehaviorRelay</code>객체에 <code>accept</code>시켜 뷰 컨트롤러로 전달 및 바인딩을 진행한다.</li></ol> <p>이때 중간의 <code>flatMapLatest</code> 코드를 보면 <code>retrieveCacheObservable</code>이라는 함수를 호출하는 것을 볼 수 있다.</p> <h2 id="retrievecacheobservable-함수에-대한-이해"><a href="#retrievecacheobservable-함수에-대한-이해" class="header-anchor">#</a> retrieveCacheObservable 함수에 대한 이해</h2> <p>아래 함수는 직접 작성한 코드이다.</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">retrieveCacheObservable</span><span class="token punctuation">(</span>posefeed<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">PosePick</span><span class="token punctuation">]</span><span class="token punctuation">,</span> isFilterSection<span class="token punctuation">:</span> <span class="token class-name">Bool</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Observable</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">CellViewModel</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> viewModelObservable <span class="token operator">=</span> <span class="token class-name">BehaviorRelay</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">CellViewModel</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    posefeed<span class="token punctuation">.</span>forEach <span class="token punctuation">{</span> posepick <span class="token keyword">in</span>
        <span class="token class-name">ImageCache</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span><span class="token function">retrieveImage</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> posepick<span class="token punctuation">.</span>poseInfo<span class="token punctuation">.</span>imageKey<span class="token punctuation">,</span> options<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token keyword">weak</span> <span class="token keyword">self</span><span class="token punctuation">]</span> result <span class="token keyword">in</span>
            <span class="token keyword">guard</span> <span class="token keyword">let</span> <span class="token keyword">self</span> <span class="token operator">=</span> <span class="token keyword">self</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
            <span class="token keyword">switch</span> result <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token keyword">let</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token keyword">let</span> image <span class="token operator">=</span> value<span class="token punctuation">.</span>image <span class="token punctuation">{</span>
                    <span class="token keyword">let</span> viewModel <span class="token operator">=</span> <span class="token class-name">CellViewModel</span><span class="token punctuation">(</span>image<span class="token punctuation">:</span> image<span class="token punctuation">,</span> poseId<span class="token punctuation">:</span> posepick<span class="token punctuation">.</span>poseInfo<span class="token punctuation">.</span>poseId<span class="token punctuation">)</span>
                    viewModelObservable<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>viewModelObservable<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token punctuation">[</span>viewModel<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">guard</span> <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> posepick<span class="token punctuation">.</span>poseInfo<span class="token punctuation">.</span>imageKey<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
                    <span class="token class-name">KingfisherManager</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">retrieveImage</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span> downloadResult <span class="token keyword">in</span>
                        <span class="token keyword">switch</span> downloadResult <span class="token punctuation">{</span>
                        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token keyword">let</span> downloadImage<span class="token punctuation">)</span><span class="token punctuation">:</span>
                            <span class="token keyword">let</span> viewModel <span class="token operator">=</span> <span class="token class-name">CellViewModel</span><span class="token punctuation">(</span>image<span class="token punctuation">:</span> downloadImage<span class="token punctuation">.</span>image<span class="token punctuation">,</span> poseId<span class="token punctuation">:</span> posepick<span class="token punctuation">.</span>poseInfo<span class="token punctuation">.</span>poseId<span class="token punctuation">)</span>
                            viewModelObservable<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>viewModelObservable<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token punctuation">[</span>viewModel<span class="token punctuation">]</span><span class="token punctuation">)</span>
                        <span class="token keyword">case</span> <span class="token punctuation">.</span>failure<span class="token punctuation">:</span>
                            <span class="token keyword">return</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token keyword">case</span> <span class="token punctuation">.</span>failure<span class="token punctuation">:</span>
                <span class="token keyword">return</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> viewModelObservable<span class="token punctuation">.</span><span class="token function">asObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token keyword">while</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>count <span class="token operator">&lt;</span> posefeed<span class="token punctuation">.</span>count <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>함수 파라미터로 <code>[PosePick]</code> 타입의 데이터를 전달받는데, 위의 JSON 예시 데이터에서 <code>content</code> 키값에 대한 밸류값이 <code>[PosePick]</code>에 해당한다. 이 값을 <code>forEach</code>로 순회하며 <code>imageKey</code>값을 추출하여 킹피셔의 이미지 캐싱 로직을 호출하게 된다.</p> <p>셀 뷰모델 배열을 생성하여 리턴하는 이유에 대해서는 <code>Input</code> &amp; <code>Output</code> &amp; <code>transform</code>에 대한 이해가 필요하다. 자세한 내용은 <a href="https://parkjju.github.io/vue-TIL/trash/230918-31.html" target="_blank" rel="noopener noreferrer">다음 글을<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 참고하자.</p> <p>중요한 <code>viewModelObservable</code>에 셀 뷰모델을 <code>accept</code>하는 등의 내용은 미뤄두고, 킹피셔 로직 자체에만 집중해보자.</p> <ol><li>초기에 킹피셔 캐시 저장소의 <code>ImageCache.default</code> 객체의 <code>retrieveImage(forKey: )</code> 파라미터를 통해 이미지 URL 기준으로 캐시에 이미지가 저장되어 있는지 여부를 체크한다.</li> <li>이미지 URL을 키값으로 하여 이미지가 이미 캐싱되어 있었다면 그대로 이미지를 객체화하여 로드한다.</li> <li>이미지가 캐싱되어 있지 않았다면 <code>KingfisherManager.shared.retrieveImage(with: url)</code> 메서드를 호출하여 이미지를 직접 다운로드한다.</li> <li>다운로드된 이미지 객체는 해당 URL을 기준으로 자동으로 캐싱된다.</li></ol> <p>이때 3~4번으로 이어지는 과정이 바로 네트워크라는 외부 환경에 종속되는 문제가 있다. 캐싱된 이미지에 접근하는 경우 메모리 내부 상황이 역시나 매번 동일한 상황이 아니기에 이에 대한 독립성 보장도 필요한데, 이는 <strong>매 테스트 셋업 단계에서 캐시를 비워줌으로써 네트워크를 통한 이미지 설치 로직만 거쳐가도록 강제하는 방법으로 우선 구현해두었다.</strong></p> <h2 id="킹피셔-options-둘러보기"><a href="#킹피셔-options-둘러보기" class="header-anchor">#</a> 킹피셔 options 둘러보기</h2> <p>테스트 코드 작성을 위해 필요한 목업 네트워킹은 다음과 같다.</p> <ol><li>북마크 컨텐츠들에 대한 정보를 갖는 JSON 파일 요청</li> <li>1번에서 획득한 JSON 내에서 이미지 URL을 추출하여 이미지 데이터 다운로드</li></ol> <p>이때 1번 과정은 <a href="/vue-TIL/trash/231202-38.html">이전 글</a>에서 작성한 <code>MockURLProtocol</code>을 통해 직접 작성한 로컬의 JSON 파일을 디코딩하는 것으로 해결하였다.</p> <p>테스트 코드를 작성할때 한 가지 유념해야 한다고 생각한 것은 테스트 대상이 현재 자신이 테스트 여부인지를 인지하면 안된다는 것이다. 코드를 이러한 방향성으로 작성하게 되면 <code>let isTest: Bool</code>과 같이 테스트 여부를 상태값으로 추가하여 관리하게 되고, 이에 따라 동일한 뷰모델 혹은 뷰컨트롤러 내에서 복잡성을 가지고 코드를 작성하게 된다.</p> <p>따라서 최대한으로 테스트 여부를 판단할 수 있는 마지노선을 테스트 대상 객체가 생성되는 시점에 특정 객체를 주입하는 것 이상으로 코드의 변경이 내부적으로 이루어지면 안된다. 예컨대 목업 URL 프로토콜을 사용할때 <strong>뷰모델에 목업 프로토콜 클래스가 지정된 세션 객체를 주입해주는 것 외에 뷰모델 클래스 내부 변경사항이 있지는 않았다.</strong></p> <p>이러한 점에서 출발하여, 2번 과정에서 이미지 URL 추출 후 직접 다운로드하는 과정을 테스트코드로 작성할 때에 현재 뷰모델이 테스트 여부인지 상태값을 추가하여 코드를 작성하면 <code>retrieveCacheObservable</code> 함수에서 가짜 객체를 리턴하는 방식으로 코드 작성이 가능은 하지만 사실상의 테스트 코드 작성의 의미가 많이 퇴색된다는 것을 알 수 있다.</p> <p>위 문제를 해결하기 위한 사고의 흐름은 다음과 같았다.</p> <ol><li><code>setUp</code> 라이프사이클에서 캐시 저장소를 완전히 비운다.</li> <li>1번 과정에 따라 목업 네트워킹을 통해 전달받은 JSON 디코딩 객체의 이미지 URL을 키값으로 할때 이에 대응되는 밸류의 이미지 객체는 존재하지 않는 상태이다.</li> <li>모든 이미지 URL은 네트워킹을 통해 다운로드를 진행해야 한다.</li> <li>킹피셔 라이브러리 내에 목업 프로토콜을 주입하여 이미지가 실제 다운로드 된것 처럼 할 수 있나?</li></ol> <p>4번 과정에 테스트 코드 작성에 핵심이 되는 부분이었는데, 결국 킹피셔에서도 URL 객체를 통한 이미지 다운로드 과정도 코드 추상화 단계를 넘어 로우한 단계로 넘어가게 되면 JSON 데이터를 요청하는 것과 유사한 방법으로 로컬 내에 등록된 가짜 이미지를 넘겨주는 방식으로 동작하도록 만들 수 있었다는 것이다.</p> <p>위의 <code>retrieveCacheObservable</code> 함수를 보면 <code>imageKey</code>값을 기준으로 캐시에 이미지 데이터가 존재하지 않는 경우 URL 객체를 생성하여 네트워크 요청으로 넘어가는 단계가 있다.</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">guard</span> <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> posepick<span class="token punctuation">.</span>poseInfo<span class="token punctuation">.</span>imageKey<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
<span class="token class-name">KingfisherManager</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">retrieveImage</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span> downloadResult <span class="token keyword">in</span>
    <span class="token keyword">switch</span> downloadResult <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token keyword">let</span> downloadImage<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">let</span> viewModel <span class="token operator">=</span> <span class="token class-name">CellViewModel</span><span class="token punctuation">(</span>image<span class="token punctuation">:</span> downloadImage<span class="token punctuation">.</span>image<span class="token punctuation">,</span> poseId<span class="token punctuation">:</span> posepick<span class="token punctuation">.</span>poseInfo<span class="token punctuation">.</span>poseId<span class="token punctuation">)</span>
        viewModelObservable<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>viewModelObservable<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token punctuation">[</span>viewModel<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>failure<span class="token punctuation">:</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>이때 <code>KingfisherManager.shared.retrieveImage</code> 메서드에 다양한 파라미터를 활용할 수 있는데, 그 중 <code>options</code> 파라미터 타입을 살펴보자. 파라미터 타입은 <code>KingfisherOptionsInfoItem</code>인데 내부에 상당히 많은 옵션들이 열거형으로 지정되어 있는 것을 볼 수 있다. 그 중 우리가 살펴볼 케이스는 <code>downloader</code> 케이스이다.</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">KingfisherOptionsInfoItem</span> <span class="token punctuation">{</span>

    <span class="token comment">/// Kingfisher will use the associated `ImageCache` object when handling related operations,</span>
    <span class="token comment">/// including trying to retrieve the cached images and store the downloaded image to it.</span>
    <span class="token keyword">case</span> <span class="token function">targetCache</span><span class="token punctuation">(</span><span class="token class-name">ImageCache</span><span class="token punctuation">)</span>

    <span class="token comment">/// The `ImageCache` for storing and retrieving original images. If `originalCache` is</span>
    <span class="token comment">/// contained in the options, it will be preferred for storing and retrieving original images.</span>
    <span class="token comment">/// If there is no `.originalCache` in the options, `.targetCache` will be used to store original images.</span>
    <span class="token comment">///</span>
    <span class="token comment">/// When using KingfisherManager to download and store an image, if `cacheOriginalImage` is</span>
    <span class="token comment">/// applied in the option, the original image will be stored to this `originalCache`. At the</span>
    <span class="token comment">/// same time, if a requested final image (with processor applied) cannot be found in `targetCache`,</span>
    <span class="token comment">/// Kingfisher will try to search the original image to check whether it is already there. If found,</span>
    <span class="token comment">/// it will be used and applied with the given processor. It is an optimization for not downloading</span>
    <span class="token comment">/// the same image for multiple times.</span>
    <span class="token keyword">case</span> <span class="token function">originalCache</span><span class="token punctuation">(</span><span class="token class-name">ImageCache</span><span class="token punctuation">)</span>

    <span class="token comment">/// Kingfisher will use the associated `ImageDownloader` object to download the requested images.</span>
    <span class="token keyword">case</span> <span class="token function">downloader</span><span class="token punctuation">(</span><span class="token class-name">ImageDownloader</span><span class="token punctuation">)</span>

    <span class="token comment">/// ....</span>
    <span class="token comment">/// ....</span>
<span class="token punctuation">}</span>
</code></pre></div><p>다운로더 옵션의 설명을 보면 <code>Kingfisher will use the associated ImageDownloader object to download the requested images.</code>라고 되어 있다. 요청하는 이미지에 대해 다운로드를 연관값으로 지정된 <code>ImageDownloader</code> 객체를 통해 지정하겠다는 의미이다.</p> <p><code>ImageDownloader</code> 객체를 살펴보면 또한 동일하게 내부적으로 다양한 속성들이 존재한다.</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">open</span> <span class="token keyword">class</span> <span class="token class-name">ImageDownloader</span> <span class="token punctuation">{</span>

    <span class="token comment">// MARK: Singleton</span>
    <span class="token comment">/// The default downloader.</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">let</span> `<span class="token keyword">default</span>` <span class="token operator">=</span> <span class="token class-name">ImageDownloader</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;default&quot;</span></span><span class="token punctuation">)</span>

    <span class="token comment">// MARK: Public Properties</span>
    <span class="token comment">/// The duration before the downloading is timeout. Default is 15 seconds.</span>
    <span class="token keyword">open</span> <span class="token keyword">var</span> downloadTimeout<span class="token punctuation">:</span> <span class="token class-name">TimeInterval</span> <span class="token operator">=</span> <span class="token number">15.0</span>

    <span class="token comment">/// A set of trusted hosts when receiving server trust challenges. A challenge with host name contained in this</span>
    <span class="token comment">/// set will be ignored. You can use this set to specify the self-signed site. It only will be used if you don't</span>
    <span class="token comment">/// specify the `authenticationChallengeResponder`.</span>
    <span class="token comment">///</span>
    <span class="token comment">/// If `authenticationChallengeResponder` is set, this property will be ignored and the implementation of</span>
    <span class="token comment">/// `authenticationChallengeResponder` will be used instead.</span>
    <span class="token keyword">open</span> <span class="token keyword">var</span> trustedHosts<span class="token punctuation">:</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;?</span>

    <span class="token comment">/// Use this to set supply a configuration for the downloader. By default,</span>
    <span class="token comment">/// NSURLSessionConfiguration.ephemeralSessionConfiguration() will be used.</span>
    <span class="token comment">///</span>
    <span class="token comment">/// You could change the configuration before a downloading task starts.</span>
    <span class="token comment">/// A configuration without persistent storage for caches is requested for downloader working correctly.</span>
    <span class="token keyword">open</span> <span class="token keyword">var</span> sessionConfiguration <span class="token operator">=</span> <span class="token class-name">URLSessionConfiguration</span><span class="token punctuation">.</span>ephemeral <span class="token punctuation">{</span>
        <span class="token keyword">didSet</span> <span class="token punctuation">{</span>
            session<span class="token punctuation">.</span><span class="token function">invalidateAndCancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            session <span class="token operator">=</span> <span class="token class-name">URLSession</span><span class="token punctuation">(</span>configuration<span class="token punctuation">:</span> sessionConfiguration<span class="token punctuation">,</span> delegate<span class="token punctuation">:</span> sessionDelegate<span class="token punctuation">,</span> delegateQueue<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// ...</span>
    <span class="token comment">/// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>이중 눈여겨 볼 부분은 바로 <code>sessionConfiguration</code>이다. <code>You could change the configuration before a downloading task starts.</code>라는 설명으로 미루어 보아 이미지 객체 다운로드를 진행하기 전 세션 객체를 직접 주입해줄 수 있음을 알 수 있다.</p> <p>JSON 데이터를 주고받을때 요청을 시작하기 전 세션 객체의 <code>Configuration</code> 속성에 접근한 뒤 <code>protocolClasses</code>를 목업 프로토콜로 지정해줬던 것과 마찬가지로 테스트코드 셋업 단계에서 <code>ImageDownloader</code> 객체를 생성하되 <code>protocolClasses</code>를 이미지 URL을 기준으로 목업 데이터를 뿌려주는 프로토콜로 지정하면 되는 것이다.</p> <p>이러한 논리 구조를 기반으로 하여 작성한 목업 이미지 다운로드 프로토콜은 다음과 같다.</p> <details class="custom-block details"><summary>MockImageDownloaderIURLProtocol 코드 전문 펼쳐보기</summary> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token class-name">Foundation</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">MockImageDownloaderIURLProtocol</span><span class="token punctuation">:</span> <span class="token class-name">URLProtocol</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">lazy</span> <span class="token keyword">var</span> session<span class="token punctuation">:</span> <span class="token class-name">URLSession</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> configuration<span class="token punctuation">:</span> <span class="token class-name">URLSessionConfiguration</span> <span class="token operator">=</span> <span class="token class-name">URLSessionConfiguration</span><span class="token punctuation">.</span><span class="token keyword">default</span>
        <span class="token keyword">return</span> <span class="token class-name">URLSession</span><span class="token punctuation">(</span>configuration<span class="token punctuation">:</span> configuration<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">enum</span> <span class="token class-name">ResponseType</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">APIError</span><span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token class-name">HTTPURLResponse</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">var</span> responseType<span class="token punctuation">:</span> <span class="token class-name">ResponseType</span><span class="token operator">!</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> dtoType<span class="token punctuation">:</span> <span class="token class-name">MockDTOType</span><span class="token operator">!</span>
<span class="token punctuation">}</span>

<span class="token keyword">extension</span> <span class="token class-name">MockImageDownloaderIURLProtocol</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">responseWithFailure</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MockImageDownloaderIURLProtocol</span><span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token class-name">MockImageDownloaderIURLProtocol</span><span class="token punctuation">.</span><span class="token class-name">ResponseType</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">APIError</span><span class="token punctuation">.</span>unknown<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">responseWithStatusCode</span><span class="token punctuation">(</span>code<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MockImageDownloaderIURLProtocol</span><span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token class-name">MockImageDownloaderIURLProtocol</span><span class="token punctuation">.</span><span class="token class-name">ResponseType</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token class-name">HTTPURLResponse</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token class-name">K</span><span class="token punctuation">.</span>baseUrl<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">,</span> statusCode<span class="token punctuation">:</span> code<span class="token punctuation">,</span> httpVersion<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">,</span> headerFields<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">responseWithDTO</span><span class="token punctuation">(</span>type<span class="token punctuation">:</span> <span class="token class-name">MockDTOType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MockImageDownloaderIURLProtocol</span><span class="token punctuation">.</span>dtoType <span class="token operator">=</span> type
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">extension</span> <span class="token class-name">MockImageDownloaderIURLProtocol</span> <span class="token punctuation">{</span>

    <span class="token keyword">enum</span> <span class="token class-name">MockDTOType</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> empty
        <span class="token keyword">case</span> cacheImage

        <span class="token keyword">var</span> fileName<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token keyword">self</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token punctuation">.</span>empty<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span>
            <span class="token keyword">case</span> <span class="token punctuation">.</span>cacheImage<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">&quot;image.jpeg&quot;</span></span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">class</span> <span class="token keyword">func</span> <span class="token function-definition function">canInit</span><span class="token punctuation">(</span>with request<span class="token punctuation">:</span> <span class="token class-name">URLRequest</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Bool</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">class</span> <span class="token keyword">func</span> <span class="token function-definition function">canonicalRequest</span><span class="token punctuation">(</span><span class="token keyword">for</span> request<span class="token punctuation">:</span> <span class="token class-name">URLRequest</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">URLRequest</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> request
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function-definition function">startLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token function">setUpMockResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token function">setUpMockData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        client<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">urlProtocol</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> didReceive<span class="token punctuation">:</span> response<span class="token operator">!</span><span class="token punctuation">,</span> cacheStoragePolicy<span class="token punctuation">:</span> <span class="token punctuation">.</span>notAllowed<span class="token punctuation">)</span>

        client<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">urlProtocol</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> didLoad<span class="token punctuation">:</span> data<span class="token operator">!</span><span class="token punctuation">)</span>

        <span class="token keyword">self</span><span class="token punctuation">.</span>client<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">urlProtocolDidFinishLoading</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">setUpMockResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">HTTPURLResponse</span><span class="token operator">?</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> response<span class="token punctuation">:</span> <span class="token class-name">HTTPURLResponse</span><span class="token operator">?</span>
        <span class="token keyword">switch</span> <span class="token class-name">MockImageDownloaderIURLProtocol</span><span class="token punctuation">.</span>responseType <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">let</span> error<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">:</span>
            client<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">urlProtocol</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> didFailWithError<span class="token punctuation">:</span> error<span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token keyword">let</span> newResponse<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">:</span>
            response <span class="token operator">=</span> newResponse
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token function">fatalError</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;No fake responses found.&quot;</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> response<span class="token operator">!</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">setUpMockData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Data</span><span class="token operator">?</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> fileName<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token class-name">MockImageDownloaderIURLProtocol</span><span class="token punctuation">.</span>dtoType<span class="token punctuation">.</span>fileName
       <span class="token comment">// 번들에 있는 json 파일로 Data 객체를 뽑아내는 과정.</span>
        <span class="token keyword">guard</span> <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token class-name">Bundle</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span>forResource<span class="token punctuation">:</span> fileName<span class="token punctuation">,</span> withExtension<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Data</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">Data</span><span class="token punctuation">(</span>contentsOf<span class="token punctuation">:</span> file<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function-definition function">stopLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <p><code>MockDTOType</code> 열거형 변경 외에는 기존 코드에서 달라지는 점은 없다.</p> <div class="custom-block tip"><p class="custom-block-title">목업 프로토콜을 각각 지정한 이유?</p> <p>이미지 다운로드 목업 네트워크 프로토콜과 일반 네트워크 통신 목업 프로토콜을 각자 지정한 이유는 <strong>동일한 테스트 케이스에서 서로 다른 네트워크 요청이 병렬적으로 이루어지기 때문이다.</strong> 테스트 코드 작성시 <code>responseWithDTO</code>, <code>responseWithStatusCode</code>를 통해 가짜 응답에 대한 정의를 미리 결정해두고 시작하는데 이러한 부분이 <strong>타입 속성(static property)을</strong> 기반으로 이루어지기 때문에 하나의 네트워크 요청에 대해 <code>responseWithStatusCode</code>값은 동일할 수 있어도 <code>responseWithDTO</code>는 달라질 수 있다.</p></div> <h2 id="테스트-코드-작성"><a href="#테스트-코드-작성" class="header-anchor">#</a> 테스트 코드 작성</h2> <p>작성한 테스트 코드를 살펴보자. <code>setUp</code>부터 보면 다음과 같이 코드를 작성할 수 있다.</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">final</span> <span class="token keyword">class</span> bookmarkTests<span class="token punctuation">:</span> <span class="token class-name">XCTestCase</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> disposeBag<span class="token punctuation">:</span> <span class="token class-name">DisposeBag</span><span class="token operator">!</span>
    <span class="token keyword">var</span> sut<span class="token punctuation">:</span> <span class="token class-name">APISession</span><span class="token operator">!</span>
    <span class="token keyword">var</span> scheduler<span class="token punctuation">:</span> <span class="token class-name">TestScheduler</span><span class="token operator">!</span>
    <span class="token keyword">var</span> viewModel<span class="token punctuation">:</span> <span class="token class-name">BookMarkViewModel</span><span class="token operator">!</span>

    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function-definition function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> session<span class="token punctuation">:</span> <span class="token class-name">Session</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> configuration<span class="token punctuation">:</span> <span class="token class-name">URLSessionConfiguration</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> configuration <span class="token operator">=</span> <span class="token class-name">URLSessionConfiguration</span><span class="token punctuation">.</span><span class="token keyword">default</span>
                configuration<span class="token punctuation">.</span>protocolClasses <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">MockURLProtocol</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">]</span>
                <span class="token keyword">return</span> configuration
            <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token class-name">Session</span><span class="token punctuation">(</span>configuration<span class="token punctuation">:</span> configuration<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">let</span> imageDownloader<span class="token punctuation">:</span> <span class="token class-name">ImageDownloader</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> downloader <span class="token operator">=</span> <span class="token class-name">ImageDownloader</span><span class="token punctuation">.</span><span class="token keyword">default</span>
            <span class="token keyword">let</span> configuration <span class="token operator">=</span> <span class="token class-name">URLSessionConfiguration</span><span class="token punctuation">.</span><span class="token keyword">default</span>
            configuration<span class="token punctuation">.</span>protocolClasses <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">MockImageDownloaderIURLProtocol</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">]</span>
            downloader<span class="token punctuation">.</span>sessionConfiguration <span class="token operator">=</span> configuration
            <span class="token keyword">return</span> downloader
        <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        sut <span class="token operator">=</span> <span class="token class-name">APISession</span><span class="token punctuation">(</span>session<span class="token punctuation">:</span> session<span class="token punctuation">)</span>
        disposeBag <span class="token operator">=</span> <span class="token class-name">DisposeBag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        scheduler <span class="token operator">=</span> <span class="token class-name">TestScheduler</span><span class="token punctuation">(</span>initialClock<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span>
        viewModel <span class="token operator">=</span> <span class="token class-name">BookMarkViewModel</span><span class="token punctuation">(</span>apiSession<span class="token punctuation">:</span> sut<span class="token punctuation">,</span> imageDownloader<span class="token punctuation">:</span> imageDownloader<span class="token punctuation">)</span> <span class="token comment">// 목업 세션 주입</span>
        <span class="token class-name">ImageCache</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span><span class="token function">clearCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 캐시 비우기</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>중간의 <code>ImageDownloader</code> 객체를 생성하는 과정에서 세션 <code>configuration</code> 속성에 접근하여 목업 이미지 다운로드 프로토콜을 직접 지정해주는 부분을 볼 수 있다. 이후 뷰모델 객체 생성시 다운로더 객체를 주입해줌으로써 뷰모델에서 <code>retrieveCacheObservable</code>을 호출할때 자신 객체의 다운로더 객체를 참조하면 <strong>외부에서 다운로더가 주입된 상태일때는 해당 객체를 사용하고, 그렇지 않은 경우 킹피셔의 디폴트 다운로더를 사용하게 되는 것이다.</strong></p> <p>뷰모델 클래스의 이니셜라이저를 잠깐 살펴보고 다시 오자.</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">BookMarkViewModel</span> <span class="token punctuation">{</span>

    <span class="token keyword">var</span> apiSession<span class="token punctuation">:</span> <span class="token class-name">APISession</span>
    <span class="token keyword">var</span> disposeBag <span class="token operator">=</span> <span class="token class-name">DisposeBag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> imageDownloader<span class="token punctuation">:</span> <span class="token class-name">ImageDownloader</span>

    <span class="token keyword">init</span><span class="token punctuation">(</span>apiSession<span class="token punctuation">:</span> <span class="token class-name">APISession</span> <span class="token operator">=</span> <span class="token class-name">APISession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> imageDownloader<span class="token punctuation">:</span> <span class="token class-name">ImageDownloader</span> <span class="token operator">=</span> <span class="token class-name">ImageDownloader</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>apiSession <span class="token operator">=</span> apiSession
        <span class="token keyword">self</span><span class="token punctuation">.</span>imageDownloader <span class="token operator">=</span> imageDownloader
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>위 코드를 보면 이니셜라이저에 디폴트값으로 <code>ImageDownloader.default</code>값을 두고 속성값을 초기화해주는 것을 볼 수 있다.</p> <p>다시 테스트코드로 넘어와서, <code>setUp</code>이후 본격적인 테스트 코드를 작성해보자.</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">test_</span>데이터가<span class="token omit keyword">_</span>없을때_empty뷰를<span class="token omit keyword">_</span>띄워주는지<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">MockURLProtocol</span><span class="token punctuation">.</span><span class="token function">responseWithStatusCode</span><span class="token punctuation">(</span>code<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">)</span>
    <span class="token class-name">MockURLProtocol</span><span class="token punctuation">.</span><span class="token function">responseWithDTO</span><span class="token punctuation">(</span>type<span class="token punctuation">:</span> <span class="token punctuation">.</span>bookmarkFeed<span class="token punctuation">)</span>

    <span class="token class-name">MockImageDownloaderIURLProtocol</span><span class="token punctuation">.</span><span class="token function">responseWithStatusCode</span><span class="token punctuation">(</span>code<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">)</span>
    <span class="token class-name">MockImageDownloaderIURLProtocol</span><span class="token punctuation">.</span><span class="token function">responseWithDTO</span><span class="token punctuation">(</span>type<span class="token punctuation">:</span> <span class="token punctuation">.</span>cacheImage<span class="token punctuation">)</span>

    <span class="token keyword">var</span> input <span class="token operator">=</span> <span class="token function">retrieveDefaultInputObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    input<span class="token punctuation">.</span>viewDidLoadTrigger <span class="token operator">=</span> scheduler<span class="token punctuation">.</span><span class="token function">createColdObservable</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">let</span> output <span class="token operator">=</span> viewModel<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> input<span class="token punctuation">)</span>
    <span class="token keyword">let</span> expectation <span class="token operator">=</span> <span class="token class-name">XCTestExpectation</span><span class="token punctuation">(</span>description<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;북마크 API 테스트&quot;</span></span><span class="token punctuation">)</span>

    scheduler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// 네트워크에 의존중..</span>
    output<span class="token punctuation">.</span>bookmarkItems
        <span class="token punctuation">.</span>compactMap <span class="token punctuation">{</span> <span class="token short-argument">$0</span> <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">drive</span><span class="token punctuation">(</span>onNext<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token short-argument">$0</span><span class="token punctuation">.</span>forEach <span class="token punctuation">{</span> element <span class="token keyword">in</span>
                <span class="token function">print</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>image<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
                <span class="token function">print</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>poseId<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            expectation<span class="token punctuation">.</span><span class="token function">fulfill</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">disposed</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> disposeBag<span class="token punctuation">)</span>

    <span class="token function">wait</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>expectation<span class="token punctuation">]</span><span class="token punctuation">,</span> timeout<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>JSON 데이터 요청과 더불어 이미지 다운로드 목업 프로토콜에 대한 응답 형태를 지정한다.</li> <li>인풋 객체를 얻고 스케줄러를 통해 트리거 옵저버블을 동작시킨다.</li> <li>아웃풋 transform 객체 및 <code>XCTestExpectation</code> 객체를 정의한다.</li> <li>스케줄러를 시작한다.</li> <li>뷰모델 내에서 정의된 인풋 트랜스폼 로직에 따라 아웃풋 객체들을 얻어낸다.</li> <li>통신을 마치고 <code>fulfill</code> 호출을 통해 테스트를 마친다.</li></ol> <p>위의 <code>output.bookmarkItems</code> 코드에 대한 이해를 위해 잠시 뷰모델 <code>transform</code> 함수로 다시 이동해보자.</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">transform</span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> <span class="token class-name">Input</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Output</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> bookmarkItems <span class="token operator">=</span> <span class="token class-name">BehaviorRelay</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">BookmarkFeedCellViewModel</span><span class="token punctuation">]</span><span class="token operator">?&gt;</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span>

    <span class="token comment">/// 1. 뷰 로드 이후 컬렉션뷰 셀 아이템 API 요청</span>
    input<span class="token punctuation">.</span>viewDidLoadTrigger
        <span class="token punctuation">.</span>flatMapLatest <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token keyword">unowned</span> <span class="token keyword">self</span><span class="token punctuation">]</span> <span class="token omit keyword">_</span> <span class="token operator">-&gt;</span> <span class="token class-name">Observable</span><span class="token operator">&lt;</span><span class="token class-name">PoseFeed</span><span class="token operator">&gt;</span> <span class="token keyword">in</span>
            <span class="token keyword">return</span> apiSession<span class="token punctuation">.</span><span class="token function">requestSingle</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">retrieveBookmarkFeed</span><span class="token punctuation">(</span>userId<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> pageNumber<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> pageSize<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>content <span class="token punctuation">}</span>
        <span class="token punctuation">.</span>flatMapLatest <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token keyword">unowned</span> <span class="token keyword">self</span><span class="token punctuation">]</span> posefeed <span class="token operator">-&gt;</span> <span class="token class-name">Observable</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">BookmarkFeedCellViewModel</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">in</span>
            <span class="token keyword">return</span> <span class="token function">retrieveCacheObservable</span><span class="token punctuation">(</span>posefeed<span class="token punctuation">:</span> posefeed<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>onNext<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            bookmarkItems<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">disposed</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> disposeBag<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token class-name">Output</span><span class="token punctuation">(</span>bookmarkItems<span class="token punctuation">:</span> bookmarkItems<span class="token punctuation">.</span><span class="token function">asDriver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>컬렉션뷰 셀에 바인딩할 셀 뷰모델 객체들을 찍어내는 과정인데, 인풋 트리거 이후 <code>requestSingle</code>에서 1차적으로 목업 프로토콜 기반으로 네트워크 통신이 이루어지고 <code>retrieveCacheObservable</code>에서 이미지 <code>downloadTask</code>에 이미지 다운로드 목업 프로토콜 기반으로 네트워크 통신이 이루어진다.</p> <p>이때 호출되는 <code>retrieveCacheObservable</code> 함수를 다시 살펴보면 다음과 같다. 우선 뷰모델 내에서 이니셜라이저를 통해 <code>ImageDownloader</code> 객체를 정의해두었음을 기억하고 아래 코드를 살펴보자.</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">retrieveCacheObservable</span><span class="token punctuation">(</span>posefeed<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">PosePick</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Observable</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">CellViewModel</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>

    <span class="token keyword">let</span> viewModelObservable <span class="token operator">=</span> <span class="token class-name">BehaviorRelay</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">CellViewModel</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    posefeed<span class="token punctuation">.</span>forEach <span class="token punctuation">{</span> posepick <span class="token keyword">in</span>
        <span class="token class-name">ImageCache</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span><span class="token function">retrieveImage</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> posepick<span class="token punctuation">.</span>poseInfo<span class="token punctuation">.</span>imageKey<span class="token punctuation">,</span> options<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token keyword">weak</span> <span class="token keyword">self</span><span class="token punctuation">]</span> result <span class="token keyword">in</span>
            <span class="token keyword">guard</span> <span class="token keyword">let</span> <span class="token keyword">self</span> <span class="token operator">=</span> <span class="token keyword">self</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
            <span class="token keyword">switch</span> result <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token keyword">let</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token keyword">let</span> image <span class="token operator">=</span> value<span class="token punctuation">.</span>image <span class="token punctuation">{</span>
                    <span class="token keyword">let</span> viewModel <span class="token operator">=</span> <span class="token class-name">CellViewModel</span><span class="token punctuation">(</span>image<span class="token punctuation">:</span> image<span class="token punctuation">,</span> poseId<span class="token punctuation">:</span> posepick<span class="token punctuation">.</span>poseInfo<span class="token punctuation">.</span>poseId<span class="token punctuation">)</span>
                    viewModelObservable<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>viewModelObservable<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token punctuation">[</span>viewModel<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">guard</span> <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> posepick<span class="token punctuation">.</span>poseInfo<span class="token punctuation">.</span>imageKey<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>

                    <span class="token comment">// 주입된 이미지 다운로더를 전달!</span>
                    <span class="token class-name">KingfisherManager</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">retrieveImage</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> url<span class="token punctuation">,</span> options<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token function">downloader</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>imageDownloader<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> downloadResult <span class="token keyword">in</span>
                        <span class="token keyword">switch</span> downloadResult <span class="token punctuation">{</span>
                        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token keyword">let</span> downloadImage<span class="token punctuation">)</span><span class="token punctuation">:</span>
                            <span class="token keyword">let</span> viewModel <span class="token operator">=</span> <span class="token class-name">CellViewModel</span><span class="token punctuation">(</span>image<span class="token punctuation">:</span> downloadImage<span class="token punctuation">.</span>image<span class="token punctuation">,</span> poseId<span class="token punctuation">:</span> posepick<span class="token punctuation">.</span>poseInfo<span class="token punctuation">.</span>poseId<span class="token punctuation">)</span>
                            viewModelObservable<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>viewModelObservable<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token punctuation">[</span>viewModel<span class="token punctuation">]</span><span class="token punctuation">)</span>
                        <span class="token keyword">case</span> <span class="token punctuation">.</span>failure<span class="token punctuation">:</span>
                            <span class="token keyword">return</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token keyword">case</span> <span class="token punctuation">.</span>failure<span class="token punctuation">:</span>
                <span class="token keyword">return</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> viewModelObservable<span class="token punctuation">.</span><span class="token function">asObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token keyword">while</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>count <span class="token operator">&lt;</span> posefeed<span class="token punctuation">.</span>count <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>중간에 보면 <code>KingfisherManager.shared.retrieveImage(with: url, options: [.downloader(self.imageDownloader)])</code> 코드가 작성된 것을 볼 수 있다.</p> <p>뷰모델에 주입된 이미지 다운로더 객체를 옵션에 전달함으로써 목업 프로토콜로 세팅된 다운로드를 진행할 수 있게 되는 것이다.</p> <h2 id="테스트-실행-결과"><a href="#테스트-실행-결과" class="header-anchor">#</a> 테스트 실행 결과</h2> <p>그렇다면 목업 프로토콜로 이미지 다운로드가 진행된 것을 어떻게 검증하는가? 브레이크 포인트 설정을 통해 현재 참조하고 있는 <code>UIImage</code> 객체를 직접 미리볼 수 있는 기능을 xcode에서 제공한다. 목업 프로토콜이 생성된 경우와 그렇지 않은 경우에 대해 xcode에서 결과가 어떻게 달라지는지 확인해보자.</p> <p><img src="/vue-TIL/assets/img/39-2.642c66ed.gif" alt="39-2"></p> <p>위 화면은 목업 프로토콜을 거쳐 얻어온 JSON 객체에서 각 이미지 URL에 접근 후 다운로드한 이미지들을 xcode 브레이크 포인트 설정을 통해 프리뷰하는 모습이다. 프리뷰하는 과정에서 이미지가 계속 달라지는 것을 볼 수 있는데, 이는 각 JSON으로부터 추출한 이미지 URL마다 새로 이미지들을 다운로드 하고 있기 때문이다.</p> <p><img src="/vue-TIL/assets/img/39-3.e893a5a8.gif" alt="39-3"></p> <p>위 화면을 다시 보면, 고양이 사진으로 일관되게 프리뷰에 표시되는 것을 볼 수 있는데 이는 <code>ImageDownloader</code> 객체에까지 목업 프로토콜을 적용했기 때문이다. 로컬에 저장되어 있는 이미지를 가짜 응답으로 내보내는 형태로 동작하기에 고양이 사진으로 일관되게 처리되는 것이다.</p> <p>목업 프로토콜이기에 일관되게 처리되었다기보다, 다시 목업 프로토콜 코드를 살펴보면 <code>MockDTOType</code> 열거형 케이스에 고양이 이미지에 대한 열거형 하나만 정의되어 있기 때문에 이런 것이다.</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">enum</span> <span class="token class-name">MockDTOType</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> empty
    <span class="token keyword">case</span> cacheImage

    <span class="token keyword">var</span> fileName<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token keyword">self</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>empty<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>cacheImage<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">&quot;image.jpeg&quot;</span></span> <span class="token comment">// 고양이 이미지</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>이미지 목업 프로토콜을 적용하게 되면 xcode 개발자 도구에서 네트워크 링크 컨디셔너에 <code>100% Loss</code> 옵션을 걸어두고 테스트 하더라도 로컬에서 가짜 응답으로 내보내기 때문에 테스트가 정상적으로 이루어지게 된다. 테스트 환경이 네트워크 환경으로부터 완전히 독립적으로 구성된 것이다.</p> <h2 id="reference"><a href="#reference" class="header-anchor">#</a> Reference</h2> <ol><li><a href="https://medium.com/@itsanurag/simulate-low-network-with-network-link-conditioner-a1a7f14423b6" target="_blank" rel="noopener noreferrer">Simulate low network with Network Link Conditioner<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://parkjju.github.io/vue-TIL/trash/230918-32.html" target="_blank" rel="noopener noreferrer">유닛 테스트 환경 구축<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://parkjju.github.io/vue-TIL/trash/231129-37.html" target="_blank" rel="noopener noreferrer">RxBlocking, RxTest로 테스트코드 작성하기<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://parkjju.github.io/vue-TIL/trash/231202-38.html" target="_blank" rel="noopener noreferrer">네트워크 목업 테스트<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue-TIL/trash/231125-35.html" class="prev">
        Snack - [iOS] RxDataSource 컬렉션뷰 헤더 SupplementaryView
      </a></span> <span class="next"><a href="/vue-TIL/trash/240416-45.html">
        Snack - [iOS] UIPageViewController에 코디네이터 패턴 적용하기
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><!----></div></div>
    <script src="/vue-TIL/assets/js/app.bfb5f89b.js" defer></script><script src="/vue-TIL/assets/js/2.f7b87a9b.js" defer></script><script src="/vue-TIL/assets/js/1.e7a4714f.js" defer></script><script src="/vue-TIL/assets/js/54.2ed0e211.js" defer></script><script src="/vue-TIL/assets/js/56.4fdfd0b1.js" defer></script>
  </body>
</html>
