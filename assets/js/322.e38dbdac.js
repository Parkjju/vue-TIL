(window.webpackJsonp=window.webpackJsonp||[]).push([[322],{864:function(t,s,a){"use strict";a.r(s);var n=a(6),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"multer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#multer"}},[t._v("#")]),t._v(" multer")]),t._v(" "),s("p",[t._v("multer는 유저가 서버에 업로드한 파일을 받아 인코딩 후 저장해주는 기능을 한다. 사용법은 다음과 같다.")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("npm i multer")])]),t._v(" "),s("li",[t._v("form태그 생성 및 "),s("code",[t._v("enctype")]),t._v(" 애트리뷰트 지정. "),s("code",[t._v('form(method="POST", enctype="multipart/form-data)')])]),t._v(" "),s("li",[t._v("템플릿에 파일을 업로드할 input태그 생성 "),s("code",[t._v('input(type="file", accept="image/*, name="myFile", id="myFile")')]),t._v(" "),s("ul",[s("li",[s("code",[t._v("accept")]),t._v(" 어트리뷰트는 파일 형식을 지정한다. (type/subtype)")])])]),t._v(" "),s("li",[t._v("multer 미들웨어 생성")]),t._v(" "),s("li",[s("strong",[t._v("POST")]),t._v("메서드를 호출하는 라우터에 multer 미들웨어 호출.")]),t._v(" "),s("li",[t._v("미들웨어를 통해 파일을 받을 수 있게 되면 이후 "),s("code",[t._v("req")]),t._v("객체로부터 "),s("code",[t._v("file")]),t._v("이라는 프로퍼티에 접근할 수 있게 된다. ("),s("code",[t._v("req.file")]),t._v(")")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" uploadFiles "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("multer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"uploads/"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("userRouter\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/edit"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("getEdit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uploadFiles"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("single")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"avatar"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" postEdit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//!!")]),t._v("\n")])])]),s("h2",{attrs:{id:"static-files"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#static-files"}},[t._v("#")]),t._v(" static files")]),t._v(" "),s("p",[t._v("사실 위의 절차대로만 파일 업로드를 진행하면 화면 단에 제대로 렌더링되지 않는다. 브라우저가 서버에 있는 파일에 알아서 접근할 수가 없으니, "),s("strong",[t._v("라우터를 정의하여 어디로 가야 파일들을 볼 수 있는지 알려줘야 한다.")])]),t._v(" "),s("p",[t._v("정적 파일들에 대한 라우터는 "),s("code",[t._v("express.static()")]),t._v(" 메서드를 활용한다.")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//server.js")]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/uploads"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" express"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("static")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"uploads"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("code",[t._v("/uploads")]),t._v(" 라우터이고, 디렉토리 이름은 uploads라는 의미이다.")]),t._v(" "),s("p",[t._v("라우터 정의 후 템플릿에서 보여주기 위해 "),s("code",[t._v("href")]),t._v(" 어트리뷰트는 "),s("code",[t._v("/")]),t._v("를 붙여줘야한다.")]),t._v(" "),s("div",{staticClass:"language-pug extra-class"},[s("pre",{pre:!0,attrs:{class:"language-pug"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("img"),s("span",{pre:!0,attrs:{class:"token attributes"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("loggedInUser"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("avatarUrl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("width")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("height")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])])]),t._v("\n")])])]),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[t._v("DB에는 파일을 직접 저장하는 것이 아니라, 파일의 경로를 저장해야한다.")]),t._v(" "),s("div",{staticClass:"language-zsh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('{ "_id" : ObjectId("615d357d8688493d150575e9"),\n"name" : "박경준이빈다",\n"email" : "rudwns3927@naver.com",\n"username" : "rudwns3927",\n"password" : "..",\n"location" : "광주",\n"socialOnly" : false,\n"__v" : 0, "avatarUrl" : "uploads/8e477b30c51bc28adea8d9fb45d08292" }\n')])])]),s("p",[t._v("avatarUrl을 보면 "),s("code",[t._v("uploads/")]),t._v("로 시작되는 경로가 저장되어 있음을 확인할 수 있다. 파일 원본은 클라우드 서버에 저장하면 된다.")])]),t._v(" "),s("p",[t._v("다른 조치없이 위의 과정대로 파일을 관리하는 것은 문제가 있다. 파일을 서버에 저장하므로, 서버 재시작이 이루어지면 메모리의 휘발성으로 인해 파일들이 소멸된다.")])])}),[],!1,null,null,null);s.default=e.exports}}]);