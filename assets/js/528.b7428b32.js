(window.webpackJsonp=window.webpackJsonp||[]).push([[528],{1139:function(t,v,_){"use strict";_.r(v);var a=_(6),e=Object(a.a)({},(function(){var t=this,v=t._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h2",{attrs:{id:"개요"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#개요"}},[t._v("#")]),t._v(" 개요")]),t._v(" "),v("h2",{attrs:{id:"ios-메모리-wwdc-세션"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#ios-메모리-wwdc-세션"}},[t._v("#")]),t._v(" iOS 메모리 WWDC 세션")]),t._v(" "),v("p",[t._v("memory footprint -> 프로그램이 실행되는 동안 사용하거나 참조하는 메인 메모리의 양")]),t._v(" "),v("h3",{attrs:{id:"페이지"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#페이지"}},[t._v("#")]),t._v(" 페이지")]),t._v(" "),v("p",[t._v("-> 페이지 당 사이즈는 일반적으로 16KB"),v("br"),t._v("\n-> 페이지 타입은 Clean & Dirty로 나눠짐"),v("br"),t._v("\n-> 앱 메모리 사용량은 "),v("code",[t._v("페이지 수 X 페이지 크기")])]),t._v(" "),v("p",[t._v("1KB 1000bytes -> int형 20000개면 80000bytes, 80KB니까 페이지는 6개")]),t._v(" "),v("p",[t._v("-> 50KB 이미지를 캐싱할 때 4페이지로 쪼개져서 메모리 매핑 진행됨")]),t._v(" "),v("h3",{attrs:{id:"가상-메모리와-페이징에-대한-개념"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#가상-메모리와-페이징에-대한-개념"}},[t._v("#")]),t._v(" 가상 메모리와 페이징에 대한 개념")]),t._v(" "),v("p",[v("a",{attrs:{href:"https://seizze.github.io/2019/12/20/iOS-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EB%9C%AF%EC%96%B4%EB%B3%B4%EA%B8%B0,-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%9D%B4%EC%8A%88-%EB%94%94%EB%B2%84%EA%B9%85%ED%95%98%EA%B8%B0,-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EB%A6%AD-%EC%B0%BE%EA%B8%B0.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS 메모리 뜯어보기"),v("OutboundLink")],1)]),t._v(" "),v("ol",[v("li",[t._v("프로그램 동작을 위한 메모리 영역은 운영체제에서 할당해준다.")]),t._v(" "),v("li",[t._v("물리적인 RAM 주소를 알려주는 것이 아닌 가상의 메모리 주소를 알려줌")]),t._v(" "),v("li",[t._v("가상 메모리 공간은 연속되지 않고 여러 군데 나뉘어 존재한다")]),t._v(" "),v("li",[t._v("페이징 방식이란 가상 메모리 공간을 일정 크기로 분할하여 각 공간을 물리적 메모리 공간에 매핑하는 방식을 말한다")]),t._v(" "),v("li",[t._v("가상 메모리 블록을 페이지라고 하고, 같은 크기의 메모리 블록을 프레임이라고 한다.")]),t._v(" "),v("li",[t._v("각 프로세스에는 페이지가 "),v("strong",[t._v("어떤 물리 주소에 매핑되어야 하는지의 정보를 저장하고 있는 페이지 테이블")]),t._v("이 존재. 페이지 테이블에는 "),v("strong",[t._v("페이지 테이블 엔트리(PTE)들이 존재")]),t._v("하며 각 PTE에는 프레임 번호와 함께 추가적인 상태 비트 저장")])]),t._v(" "),v("p",[v("img",{attrs:{src:"page-table-entry%20%281%29.png",alt:""}})]),t._v(" "),v("h3",{attrs:{id:"앱-사용량-footprint-의-구성요소"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#앱-사용량-footprint-의-구성요소"}},[t._v("#")]),t._v(" 앱 사용량 (footprint)의 구성요소")]),t._v(" "),v("p",[t._v("-> Dirty")]),t._v(" "),v("ol",[v("li",[t._v("앱에서 사용된 메모리")]),t._v(" "),v("li",[t._v("Array, NSCache, malloc, UIViews..")]),t._v(" "),v("li",[t._v("힙 할당, 객체들")]),t._v(" "),v("li",[t._v("디코딩 이미지 버퍼")]),t._v(" "),v("li",[t._v("UIKit, CoreGraphics.. 프레임워크들")])]),t._v(" "),v("p",[t._v("-> Compressed")]),t._v(" "),v("ol",[v("li",[t._v("액세스 되지 않은 페이지를 가져와서 압축 후 더 많은 공간을 만들어주는 공간")]),t._v(" "),v("li",[t._v("iOS에서는 디스크 스왑을 제공하지 않는다. (하드 일부를 RAM처럼 사용하게 해주는 것)\n"),v("ol",[v("li",[t._v("메모리가 부족할때 당장 필요치 않은 데이터를 하드에 옮겨 사용")])])]),t._v(" "),v("li",[t._v("여러 페이지에 할당된 데이터가 있을때 액세스 빈도가 낮은 경우 자동으로 압축")])]),t._v(" "),v("p",[t._v("-> Clean 구성 데이터")]),t._v(" "),v("ol",[v("li",[t._v("페이징 가능한 대상들")]),t._v(" "),v("li",[t._v("memory mapped files (jpg 기타 등등)")]),t._v(" "),v("li",[t._v("프레임워크")])]),t._v(" "),v("h3",{attrs:{id:"메모리-경고"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#메모리-경고"}},[t._v("#")]),t._v(" 메모리 경고?")]),t._v(" "),v("p",[v("code",[t._v("didReceiveMemoryWarning()")]),v("br"),t._v("\n-> 메모리 부족 현상이 발생한 경우 시스템에서 자동으로 호출되는 함수"),v("br"),t._v("\n-> 오버라이딩 하여 해당 함수 호출시 캐싱 정책을 디테일하게 만질 필요가 있을 수도 (캐싱 일시중단 or 백그라운드 작업제한)")]),t._v(" "),v("div",{staticClass:"language-swift extra-class"},[v("pre",{pre:!0,attrs:{class:"language-swift"}},[v("code",[v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token function-definition function"}},[t._v("didReceiveMemoryWarning")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tcache"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),v("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeAllObjects")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),v("span",{pre:!0,attrs:{class:"token function"}},[t._v("didReceiveMemoryWarning")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),v("h3",{attrs:{id:"캐싱-주의점"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#캐싱-주의점"}},[t._v("#")]),t._v(" 캐싱 주의점")]),t._v(" "),v("ol",[v("li",[t._v("CPU 절약을 위해 캐싱을 사용하되, 너무 많이 사용하면 메모리를 모두 소진하여 문제 발생")]),t._v(" "),v("li",[t._v("컴프레서를 통해 액세스가 덜한 메모리를 잘 처리하기")])]),t._v(" "),v("h3",{attrs:{id:"memory-limit"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#memory-limit"}},[t._v("#")]),t._v(" Memory Limit")]),t._v(" "),v("ol",[v("li",[t._v("기기마다 너무 다르다 (1GB ~ 4GB)")])]),t._v(" "),v("h3",{attrs:{id:"프로파일링"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#프로파일링"}},[t._v("#")]),t._v(" 프로파일링")]),t._v(" "),v("ol",[v("li",[t._v("VM Tracker\n"),v("ul",[v("li",[t._v("Xcode Instruments -> Dirty & Compressed 메모리를 트래킹할 때 사용")])])]),t._v(" "),v("li",[t._v("VM Memory trace\n"),v("ul",[v("li",[t._v("앱 가상메모리 시스템 성능 체크")]),t._v(" "),v("li",[v("strong",[t._v("캐시 히트")]),t._v(" 체크")])])]),t._v(" "),v("li",[t._v("기기 메모리 제한에 접근 -> EXC 리소스 예외 발생, 디버거 자동으로 시작\n"),v("ol",[v("li",[t._v("memgraph 보여줌")]),t._v(" "),v("li",[t._v("CLI 환경에서 "),v("code",[t._v(".memgraph")]),t._v(" 파일 내보낸 뒤 "),v("code",[t._v("vmmap App.memgraph")]),t._v("로 읽으면 메모리 소비에 대한 분석을 요약해줌")]),t._v(" "),v("li",[t._v("더티 메모리, 스왑 & 컴프레싱 메모리 양에 대해 세부 정보 제공")]),t._v(" "),v("li",[t._v("더티와 스왑이 중요한데, "),v("strong",[t._v("스왑 크기가 압축 이후 데이터가 아니라 압축 이전의 크기를 제공한다는 것")])])])])]),t._v(" "),v("h3",{attrs:{id:"images-in-ios"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#images-in-ios"}},[t._v("#")]),t._v(" Images in iOS")]),t._v(" "),v("p",[t._v("-> 2048 X 1536 픽셀의 이미지가 있을때, 파일 사이즈는 590KB이지만, 메모리에 로드될 때는 10MB이다. (픽셀당 4바이트)"),v("br"),t._v("\n-> 실제 파일사이즈와 메모리상에서 사용되는 이미지 객체 크기 차이가 크기 때문에.. iOS에서 이미지가 다뤄지는 과정을 알아야함")]),t._v(" "),v("p",[t._v("이미지는 세 단계에 거쳐 렌더링된다.")]),t._v(" "),v("ol",[v("li",[t._v("Load -> 원본 파일데이터 로드 (590KB)")]),t._v(" "),v("li",[t._v("Decode -> GPU가 읽을 수 있는 형태로 변환 (10MB, 압축 풀기), SRGB 포맷\n"),v("ul",[v("li",[t._v("iOS에서는 풍부한 색 표현을 위해 와이드 포맷이라는 것을 사용함 (사용 안해도 됨)")]),t._v(" "),v("li",[t._v("더 작게 알파 8포맷 혹은 루미넌스 포맷 사용 가능 (일반적으로는 사용 X)")]),t._v(" "),v("li",[t._v("1바이트 ~ 8바이트까지 처리 가능하다는 것을 아는게 중요하다.")]),t._v(" "),v("li",[t._v("어떤 형식을 선택하느냐? UIGraphics ImageRenderer API를 사용하면 가장 적합한 그래픽 방식을 선택함.\n"),v("ul",[v("li",[v("code",[t._v("UIBezierPath")]),t._v(" 로 원을 그릴때 "),v("code",[t._v("UIGraphicsBeginImageContextWithOptions")]),t._v(" 레거시 API를 사용하면 픽셀당 4바이트로 처리")]),t._v(" "),v("li",[v("code",[t._v("UIGraphicsImageRenderer")]),t._v(" 로 처리한 경우 자동으로 픽셀당 1바이트로 처리")]),t._v(" "),v("li",[t._v("동일한 마스크 사용하면서 "),v("code",[t._v("tintColor")]),t._v("만 사용하면 불필요한 메모리 사용량 줄일 수 있음")])])])])]),t._v(" "),v("li",[t._v("Render -> 렌더링")])]),t._v(" "),v("p",[v("strong",[t._v("이미지 리사이징")])]),t._v(" "),v("ol",[v("li",[t._v("UIImage는 리사이징 하는데에 비용이 많이든다.\n"),v("ul",[v("li",[t._v("내부 좌표 공간 변화로 인해 성능이 조금 떨어진다.")]),t._v(" "),v("li",[t._v("메모리 압축을 디코딩 과정도 포함되어서 성능에 추가비용 존재")])])]),t._v(" "),v("li",[v("code",[t._v("ImageIO API")]),t._v(" "),v("ul",[v("li",[t._v("이미지 다운샘플링, 이미지")]),t._v(" "),v("li",[t._v("로우레벨 -> 파일 앱에서 이미지 가져올때 사용해보기")])])])]),t._v(" "),v("p",[v("strong",[t._v("백그라운드")]),v("br"),t._v("\n-> 노티피케이션 센터의 "),v("code",[t._v("UIApplicationDidEnterBackground")]),t._v(" 사용, 앱 백그라운드 진입시 이미지 언로드"),v("br"),t._v("\n-> 노티피케이션 센터의 "),v("code",[t._v("UIApplicationWillEnterForeground")]),t._v(" 사용, 앱 포어그라운드 진입시 이미지 로드")])])}),[],!1,null,null,null);v.default=e.exports}}]);