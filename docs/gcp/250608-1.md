---
title: Google Cloud Platform - Get Certified Program (Virtual Machines and Networks in the Cloud)
---

## VPC (Virtual Private Cloud networking)

VPC는 퍼블릭 클라우드 내에서 호스팅되는 안전하고, 독립적인 클라우드 컴퓨팅 모델이다. 코드 실행, 데이터 저장, 웹사이트 호스팅 등 여러 일반적인 작업들을 수행할 수 있지만 퍼블릭 클라우드 사업자가 직접 원격으로 호스팅한다. 이는 VPC가 퍼블릭 클라우드의 확장성(scalability)과 편의성에 프라이빗 클라우드의 데이터 격리라는 특징을 혼합한 것이라 볼 수 있다.

VPC 네트워크는 리소스들간의 연결과 인터넷으로의 연결을 지원한다. 여기에는 아래 작업들이 포함된다.

1. 네트워크를 분할(Segmenting Networks)
2. 방화벽 규칙(Firewall Rules)을 사용하여 인스턴스에 대한 접근을 제한
3. 특정 목적지로 트래픽을 전달하기 위한 정적 라우트(Static Routes) 생성 등

구글 클라우드 VPC 네트워크는 **글로벌 네트워크이다.** 또한 VPC 네트워크는 서브넷을 가질 수 있는데, 서브넷은 전체 네트워크에서 세분화된 네트워크 영역이다. 서브넷은 구글 클라우드 전 세계 어느 리전에서든 설정할 수 있다.

이러한 아키텍처를 기반으로 글로벌 범위를 가진 네트워크 구성을 쉽게 할 수 있다. 다른 Zone에 존재하는 리소스들도 동일 서브넷 내에 존재할 수 있다.

VPC 네트워크의 범위와 관련되어 AWS와 큰 차이가 발생하는데 이를 정리하면 아래와 같게 된다.

```text
# AWS
[us-east-1 VPC] --- Peering --- [asia-northeast3 VPC]

# GCP
[Global VPC]
 ├─ us-central1 Subnet
 ├─ europe-west1 Subnet
 ├─ asia-northeast3 Subnet
```

AWS는 하나의 리전에 하나의 VPC를 배포할 수 있지만 GCP는 기본적으로 VPC가 글로벌 범위이기 때문에 서브넷 구성을 어떻게 하느냐에 따라 리소스들 간 프라이빗 연결을 새롭게 구성할 수 있게 된다.

글로벌 VPC상에서 서로 다른 리전에 각각 서브넷을 생성했다고 가정했을때, 서브넷 크기는 IP주소 범위를 어떻게 지정하느냐에 따라 커질 수 있다. 하지만 IP범위 확장은 가상 머신에 영향을 주지는 않는다.

서브넷에 할당할 수 있는 IP주소 갯수는 CIDR(Classless Inter-Domain Routing) 기법을 통해 표기할 수 있다. `A.B.C.D/N` 형식으로 표기한다. `A.B.C.D`는 네트워크 시작 주소를 나타내며 `/N`은 고정 비트 수로 N값이 클 수록 더 적게 IP 주소를 할당하게 된다.

```text
할당 가능한 IP 수 = 2^(32 - N) - 예약된 IP (Google Cloud에서는 4개 예약됨)
```

## Compute Engine

Compute Engine을 사용하면 가상머신을 생성하고 실행할 수 있다. 실제 서버 기기에 대한 투자 없이도 수천개의 가상 CPU들을 실행할 수 있다.

각 가상머신은 완전한 기능을 갖춘(full-fledged) OS의 성능과 기능을 포함한다. 이는 가상 머신을 실제 물리 서버처럼 직접 구성할 수 있다는 것을 의미한다.

1. 필요한 CPU 성능과 메모리 용량을 지정
2. 필요한 스토리지의 용량과 유형을 선택
3. 사용할 운영체제를 설정

가상 머신 인스턴스는 단독으로 생성하거나, 관리형 인스턴스 그룹(Managed Instance Group, MIG)을 구성하여 생성할 수 있다. 인스턴스 생성은 웹 기반 구글 클라우드 콘솔, 구글 클라우드 CLI, Compute Engine API를 통해 수행할 수 있다.

인스턴스는 구글에서 제공하는 리눅스와 윈도우 서버 이미지를 가지고 구동할 수 있고, 이러한 이미지들에 대해 직접 커스텀한 버전으로도 구동 가능하다. 뿐만 아니라 다른 OS 이미지를 직접 빌드하고 수행할 수도 있다.

Cloud 마켓플레이스를 이용하면 구글과 서드파티 공급업체가 제공하는 솔루션들을 활용할 수 있다. 소프트웨어, VM 인스턴스, 스토리지, 네트워크 설정 등을 직접 구성할 필요가 없다. 필요에 따라 배포 전에 세부 설정은 수정 가능하다. 대부분의 패키지는 클라우드 리소스 사용 요금 외에는 별도의 추가 요금이 필요하지 않다. (상업용 라이선스 소프트웨어 포함 시에는 별도 비용 청구)

스토리지 측면에서 높은 처리량(throughput)을 위해 특정 스토리지 옵션 / 머신 타입을 커스텀할 필요는 없다. 기본 설정으로도 충분히 높은 처리성능 및 Persistent Disk간의 높은 처리량이 제공되고, 이는 추가 비용없이 제공된다. 아래는 스토리지 옵션들이다.

1. Zonal Persistent Disk: 효율적이고 안정적인 Zone 단위 블록 스토리지
2. Regional Persistent Disk: 두개의 Zone에 복제되는 Region 블록 스토리지
3. Local SSD: 일시적(Transient) 로컬 블록 스토리지 / VM 종료시 데이터 소멸
4. Cloud Storage Buckets: 저렴한 객체 스토리지 / 파일 단위 저장
5. Filestore: 고성능 파일 스토리지 (NFS 기반 파일 시스템 제공)

일반적인 방법은 Persistent Disk를 인스턴스에 추가해서 사용하는 것이다.

:::tip NFS 파일 시스템 vs 블록 스토리지

1. NFS(Network File System) 기반 파일 시스템: 네트워크를 통해 접근할 수 있는 파일 시스템
   - 네트워크 상의 다른 서버에 있는 스토리지를 내 로컬 디스크처럼 사용할 수 있게 해주는 프로토콜
   - 서버 여러대가 동시에 공유된 스토리지를 사용해야 할 때 사용
   - 파일 단위 접근이 가능
2. 블록 스토리지 기반 파일 시스템: 데이터를 블록 단위로 저장하고 관리하는 파일 시스템
   - 디스크 전체를 OS가 마운트해서 사용
   - 특정 VM에만 연결 (일반적으로 1개 VM)
   - 블록 크기는 일반적으로 512바이트 / 4KB 등으로 설정. 디스크 및 스토리지 레벨에서 이미 결정되어 있음. 블록 크기가 클 수록 대용량 파일 처리에 유리하다. (작은 파일이 많으면 내부 단편화 발생)
   - 물리적인 디스크의 블록 크기와 포맷 시 지정하는 블록 크기가 달라도 파일 시스템 드라이버 레벨에서 파일 쓰기 작업을 조율하게 됨. (포맷 시 8KB, 물리적인 블록 크기가 4KB일때 - 4KB를 연속으로 쓰기 / 읽기)

마운트란, 스토리지를 운영체제 디렉토리 구조에 연결하는 것을 의미한다. (파일 시스템을 폴더처럼 사용할 수 있게 연결하는 작업)

:::

### Compute Engine pricing and billing

- VM 사용시 1초 단위 과금
- 한달 중 25%이상 비율로 실행되는 경우 분 단위 할인 자동 적용
- **커밋 사용 할인(Committed-use Discount)**: 1년 / 3년 사용 약정시 vCPU및 메모리 구매 금액을 최대 57%까지 할인 가능
- 프리엠티블 VM: 대용량 데이터셋을 분석하는 배치 작업처럼 실시간성이 필요하지 않으면 preemptible VM 선택 후 비용을 최대 90%까지 절약 가능
  - **구글 데이터센터에서** 해당 리소스가 다른 곳에 필요할 경우 해당 VM을 중단할 수 있음
  - 최대 24시간까지 실행 가능
- 스팟 VM: 최대 실행시간 제한 없다는 차이점 외에 프리엠티블 VM과 동일함

프리엠티블 VM / 스팟 VM은 인스턴스가 언제든 중단될 수 있기 때문에 이에 대비한 안정적인 설계가 추가로 필요하다. (Checkpoint / Resumable Processing)

프리엠티블 VM은 최대 24시간으로 실행시간 설정을 해두어도 12시간이 지난 시점에 GCP에 의해 중단된 경우 중단 상태로 남게된다.

## Scaling Virtual Machines

Compute Engine은 인스턴스에 대해 가장 적합한 머신 속성 선택이 가능하다. 더 나아가, 이를 유연하게 활용하기 위해 **오토스케일링(Authscaling)** 또한 제공된다. 부하(Load) 지표에 따라 VM 인스턴스를 자동으로 추가하거나 제거할 수 있다. 오토스케일링 동작을 위해서는 인입되는 트래픽을 VM간에 균등하게 분산하는 작업이 필요하다. 구글 VPC가 이를 위해 여러 종류의 **로드 밸런싱 방식을** 지원한다.

Compute Engine에는 대형 VM 구성도 가능하여 인메모리 DB나 CPU 집약적 분석 같은 작업도 가능하다. 하지만 일반적으로는 스케일 업보다는 스케일 아웃으로 인프라 구축을 시작한다.

- 스케일 업: 한 대의 머신의 성능을 키우는 것
  - 구조 단순
  - 데이터 공유 및 일관성
  - 무거운 워크로드 처리에 유리
  - 물리적 한계 / 비용 효율이 비선형적 / 장애 리스크
- 스케일 아웃: 머신 갯수를 늘려서 여러 대가 병렬로 작업을 처리하게 만드는 것
  - 확장성 뛰어남
  - 고가용성 구현, 장애 대응에 유리
  - 비용 효율
  - 아키텍처 복잡도 크고, 로드밸런서 필요

VM당 최대 CPU 수는 머신 패밀리에 따라 결정되고 사용자의 Quota 설정에 따른 제약도 받는다. (Zone마다 할당량이 다를 수 있음. Zone마다 가용 가능한 vCPU 갯수가 다를 수 있기 때문 - 다른 사용자들도 해당 Zone의 리소스를 사용할 수 있음)

:::tip What is Machine Family?

비슷한 성능 특성 / 사용 목적을 가진 머신 유형들의 그룹을 의미한다. 이러한 그룹이 존재하는 이유는 워크로드 특성에 따라 필요한 VM 사양이 다르기 때문이다.

1. CPU 성능이 중요한 워크로드
2. 메모리 용량이 중요한 워크로드
3. 저렴한 비용이 중요한 워크로드
4. 균형 잡힌 일반적인 성능의 워크로드

대표적인 머신 패밀리는 아래와 같다.

1. E2 - 저렴한 비용
2. N2 / N2D - CPU & 메모리 균형
3. C2 / C3 - 고성능 컴퓨팅 (CPU 중심)
4. M1 / M2 / M3 - 메모리 최적화
5. T2D - 비용 효율

:::
