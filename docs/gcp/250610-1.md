---
title: Google Cloud Platform - Get Certified Program (Storage in the Cloud)
---

## Cloud Storage

클라우드 스토리지는 내구성과 높은 가용성을 제공하는 오브젝트 스토리지 서비스이다. 오브젝트 스토리지란, 데이터를 오브젝트 단위로 저장하는 컴퓨터 데이터 저장 아키텍처를 말한다. 이는 데이터를 파일 / 폴더 계층 구조(파일 스토리지)나 블록 단위(블록 스토리지)로 관리하는 방식과는 다르다.

오브젝트는 패키지 형식으로 저장되는데, 해당 패키지에는 아래와 같은 정보들이 포함된다.

1. 실제 데이터(바이너리 형태)
2. 메타데이터 (생성 날짜, 작성자, 리소스 유형, 권한 등)
3. 전역 고유 식별자 (일반적으로 URL 형식의 키 형태로 제공)

오브젝트 스토리지에는 주로 동영상, 이미지, 오디오 녹음 유형의 파일들이 저장된다. 사용자가 원하는 만큼의 데이터를 저장하고 필요한 만큼 데이터를 조회할 수 있다.

클라우드 스토리지는 완전 관리형이고 확장 가능한 서비스이다. 주된 용도는 바이너리 대형 객체(BLOB, Binary Large Object) 저장이 필요한 경우이다. 클라우드 스토리지는 아래와 같이 다양한 용도로 활용될 수 있다.

1. 웹사이트 컨텐츠 제공
2. 아카이빙 및 재해복구용 데이터 저장
3. 대용량 데이터 객체를 사용자가 직접 다운로드하는 방식으로 배포

클라우드 스토리지 파일들은 버킷 단위로 구성된다. 버킷 생성 시에는 전 세계에서 고유한 이름과 저장될 특정 지리적 위치를 지정해야 한다. 버킷의 이상적인 위치는 **지연을 최소화할 수 있는 위치이다.**

클라우드 스토리지에서 제공하는 저장 객체는(Storage Object) **불변이다.** 이는 객체를 직접 수정하는 것이 아니라 **변경이 발생할 때마다 새로운 버전이 생성된다는 것**을 의미한다.

관리자는 새로운 버전이 **기존 버전을 완전히 덮어쓰게(Overwrite)**할지, 버킷 내 **버전관리 기능을 활성화**하여 특정 객체에 대한 모든 변경 사항을 추적할지 선택할 수 있다.

버저닝 옵션을 선택하면 버킷 내 모든 객체에 대한 수정 및 삭제 작업의 상세 변경 이력을 유지하게 된다. 버저닝 활성화 시 아래와 같은 작업들이 가능하다.

1. 객체의 보관된 버전 목록 확인
   - 버저닝 활성화 시 객체를 수정하거나 삭제하면 해당 객체는 그냥 삭제되지 않고 Archived 상태로 변경된다.
2. 객체를 이전 상태로 복원
3. 특정 객체 버전을 영구적으로 삭제

클라우드 스토리지는 객체에 대한 수명 관리가 가능하며 특정 날짜, 생성일 기준 지난 날짜, 최근 N개 버전만 유지하는 등 다양한 정책을 설정할 수 있다.

많은 경우 개인 식별정보가 데이터 객체에 포함될 수 있다. 따라서 저장된 데이터에 대한 접근을 제어하는 것은 보안 및 프라이버시 유지에 필수적이다. **IAM과 액세스 제어 목록(ACL, Access Control List)를 사용하면** 보안에 있어 베스트 프랙티스를 준수할 수 있다. (사용자는 필요한 권한까지만 부여되고 그 이상은 부여되지 않음)

객체 및 버킷에 대한 사용자 접근을 위해서는 아래 몇 가지 방법을 사용한다.

1. 대부분 IAM으로 충분 (IAM 역할은 프로젝트 -> 버킷 -> 객체로 상속)
2. 세밀한 제어를 위해 ACL 생성. ACL은 아래 두 가지 정보로 구성
   - 범위(Scope): 해당 객체 또는 버킷에 누가 액세스 가능한지 정의 (특정 사용자 or 사용자 그룹)
   - 권한(Permission): 어떤 행동을 수행할 수 있는지 정의 (읽기, 쓰기)

클라우드 스토리지는 파일 시스템은 아니지만 버킷을 일반적인 리눅스 / MacOS 디렉터리처럼 사용할 수 있도록 버킷을 마운트해주는 서드파티 도구를 통해 파일 시스템처럼 접근이 가능하다.

1. gcsfuse: 버킷을 리눅스 / MacOS 디렉터리로 마운트
2. rclone: 다양한 클라우드 스토리지를 마운트 / 동기화 / 백업할 수 있는 도구
3. Cloud Storage FUSE: 구글 공식 관리버전 마운트 도구

클라우드 스토리지에는 네 가지 주요 스토리지 클래스가 존재한다. 저장 데이터는 소속 클래스에 따라 다르게 관리 및 과금된다.

1. Standard Storage
   - 자주(Frequently) 액세스되는 핫 데이터에 적합
   - 짧은 기간 동안만 저장되는 데이터에도 적합
2. Nearline Storage
   - 가끔(Infrequently) 액세스되는 데이터에 적합 (ex - 월 1회)
   - 데이터 백업, 장기 보관 멀티미디어 콘텐츠(Long-tail Multimedia Content), 데이터 아카이빙 등
3. Coldline Storage
   - 가끔 액세스되는 데이터용 / 저렴한 옵션
   - Nearline보다 더 적은 빈도로 사용되는 데이터에 적합 (평균 90일에 한 번 이하로 데이터 읽기 및 수정)
4. Archive Storage
   - 가장 저렴한 비용으로 제공
   - 데이터 아카이빙 / 온라인 백업 / 재해 복구 용도
   - 연 1회 이하로 데이터 접근 계획 시 적합
   - 데이터 접근 및 작업 비용이 높고 365일 최소 저장 기간이 적용

더 자주 접근 가능한 저장소일수록 작업비용이 커진다. 저장비용과 작업비용이 반비례한다고 보면 된다.

위의 스토리지들은 공통으로 적용되는 여러 특징들이 있다.

1. 무제한 저장 용량 제공 (최소 객체 크기 제한 X)
2. 전 세계 어디서든 접근 가능, 다양한 위치에서 서비스 제공
3. 낮은 지연 시간 / 높은 내구성
4. 보안 / 도구 / API 사용 경험이 일관적 (스토리지 클래스 여부에 상관없음)
5. 다중리전 / 듀얼리전에 저장하는 경우 지리적 중복성 제공 (데이터 중복 저장)
   - 대규모 재해 / 자연재해 대비
   - 트래픽 로드밸런싱 제공

클라우드 스토리지는 Autoclass 기능도 제공한다. 각 객체 접근패턴에 따라 적절한 스토리지 클래스로 자동 전환해준다.

1. 자주 접근되지 않은 데이터는 더 저렴한 스토리지 클래스로 이동시켜 스토리지 비용 절감
2. 자주 접근되는 데이터는 standard storage로 이동시켜 접근 및 작업 성능 최적화

```text
my-bucket (하나의 버킷)

├── photo1.jpg → Standard
├── photo2.jpg → Nearline
├── video1.mp4 → Coldline
├── backup.tar.gz → Archive
```

버킷 스토리지 클래스를 Autoclass로 지정하는 경우 각 객체별로 스토리지 클래스가 위와 같이 달라질 수 있다. 버킷 기본 옵션을 Nearline이라고 지정하면 기본적으로 객체 저장 시에는 Nearline으로 저장되지만, 저장시 명시적으로 클래스를 다르게 오버라이딩 가능하다.

클라우드 스토리지는 아래와 같은 과금 및 보안구조를 갖는다.

1. No minimum fee - 사전 용량 예약 불필요
   - 클라우드 스토리지는 선불 구조가 아님
   - 실제로 저장한 데이터 용량 기준으로 과금 (월단위 청구, 초단위 사용량 기록)
2. 서버 측 암호화
   - 클라우드 스토리지에 저장되는 모든 데이터는 자동으로 암호화된다. (구글 자체 제공)
   - 추가 비용 없음
3. HTTPS/TLS를 통한 전송 중 암호화
   - 사용자 기기에서 구글 Cloud로 데이터 전송하는 경우에도 TLS 기반 HTTPS 연결을 사용한다.

스토리지에 데이터를 전송하기 위해서는 Google Cloud SDK의 `gcloud storage` 명령어를 사용하거나 Google Cloud 콘솔을 통해 웹 브라우저에서 드래그 앤 드롭 기능을 사용하면 데이터를 쉽게 옮길 수 있다.

만약 테라바이트 / 페타바이트 규모의 데이터를 업로드 해야 하는 경우 `Storage Transfer Service`를 사용하면 된다. 해당 서비스는 대량 온라인 데이터를 스토리지로 빠르고 비용 효율적으로 가져올 수 있는 서비스이다.

아래와 같은 경우에 배치 전송을 예약하고 관리할 수 있도록 지원한다.

1. 다른 클라우드 업체에서 클라우드 스토리지로 데이터 이전
2. 다른 클라우드 스토리지 리전 간 데이터 이전
3. HTTP(S) 엔드포인트에서 클라우드 스토리지로 데이터 이전

또, `Transfer Applicance`라는 옵션도 존재하는데, 이는 구글 클라우드로부터 임대할 수 있는 고용량의 랙 장착형 스토리지 서버이다. 해당 장비를 네트워크에 연결한 뒤 데이터를 로컬로 복사하여 저장한다. 해당 장비를 구글이 업로드 시설에 직접 배송하면 구글 스토리지로 데이터가 업로드된다.

단일 `Transfer Appliance`한 대로 최대 1페타바이트 데이터 전송이 가능하다.

클라우드 스토리지는 다른 서비스들과 긴밀하게 통합되어 있기 때문에 데이터를 스토리지로 가져오는 다른 방법들이 많다.

1. 빅쿼리 및 Cloud SQL로부터 테이블을 가져오거나 내보내기
2. App Engine 로그 / Firestore 백업 / App Engine 어플리케이션에서 사용하는 객체 저장
3. Compute Engine 인스턴스 시작 스크립트 / Compute Engine 이미지 / Compute Engine 어플리케이션에서 사용하는 객체 저장

## Cloud SQL

Cloud SQL은 MySQL, PostgreSQL, SQL Server를 포함한 완전 관리형 (Fully Managed) 관계형 데이터베이스를 서비스 형태로 제공한다. 이 서비스는 반복적이지만 필수적이고 많은 시간이 소요되는 작업들을 구글이 대신 관리하도록 설게되었다.

- Patch / Update 적용
- 백업관리
- DB 복제 구성

클라우드 SQL은 아래와 같은 장점들을 갖는다.

1. 별도 소프트웨어 설치 및 유지 관리가 필요없음
2. 최대 128 프로세스 코어 / 864GB RAM / 64TB까지 스케일업 가능
3. 자동 복제 시나리오 제공
   - 클라우드 SQL 기본(Primary) 인스턴스로부터 복제
   - 외부 기본(Primary) 인스턴스로부터 복제
     - **Primary 인스턴스는 유일한 데이터 원본 역할을 하는 인스턴스를 말한다.**
   - 외부 MySQL 인스턴스로부터 복제
4. 관리형 백업 지원
   - 백업데이터의 안전한 보관 / 필요 시 복원
   - 인스턴스 비용 자체에 최대 7개 백업 포함
5. 구글 내부 네트워크 / DB 테이블 / 임시 파일 / 백업 데이터는 모두 암호화
6. 각 DB 인스턴스에 네트워크 방화벽 포함 (접근 제어)

Cloud SQL는 다른 서비스에서도 접근이 가능하다.

- App Engine과 함께 사용 가능
- 파이썬의 MySQLdb같은 표준 DB드라이버를 사용하면 연결 가능 => 애플리케이션 데이터베이스로 쉽게 활용이 가능하다.

:::tip 표준 DB 드라이버란?

애플리케이션(코드)이 데이터베이스와 통신할 수 있도록 도와주는 소프트웨어 구성 요소이다. 개발자가 작성한 코드(SQL 쿼리 등)을 네트워크 프로토콜로 변환하여 DB서버에 전달하고, DB 서버 응답을 받아 다시 애플리케이션에서 사용할 수 있는 형태로 바꿔줌.

DBMS(데이터베이스 관리 시스템)와 통신하기 위해 업계 표준으로 사용되는 공식 드라이버

:::

Compute Engine 인스턴스는 Cloud SQL 인스턴스에 접근할 수 있도록 권한부여가 가능하다. 또한 Cloud SQL 인스턴스를 가상머신과 같은 Zone에 구성하는 것도 가능하다.

Cloud SQL은 SQL Workbench, Toad와 같은 외부 애플리케이션과도 호환된다.

## Spanner

Spanner는 완전 관리형 관계형 데이터베이스 서비스이다. 수평 확장이 가능하고 강력한 일관성을 제공하며 SQL로 쿼리가 가능하다. 강력한 일관성이란 다중 노드 리전 환경에서도 최신 데이터 상태가 모든 노드에 동기화 되어 제공됨을 말한다.

Spanner는 아래 요구사항을 필요로 하는 어플리케이션에 적합하다.

1. Join및 보조인덱스를 지원하는 SQL 기반 RDBMS가 필요한 경우
2. 내장된 고가용성이 필요한 경우 (장애가 발생해도 지속 가능한 서비스)
3. 전역적으로 강력한 일관성이 필요한 경우
4. 초당 수만건 이상의 높은 I/O 작업 처리량이 필요한 경우

:::tip 기본(Primary) 인덱스 vs 보조(Secondary) 인덱스

우선 인덱스란, DB에서 조회를 빠르게 하기 위한 데이터 구조이다.

- 기본 인덱스(Primary Index or Clustered Index)
  - 테이블의 Primary Key 대해 자동으로 생성
  - 데이터 자체가 Primary Key 순서대로 정렬되어 저장
  - Primary Key 기준으로 검색할 때 가장 빠름
- 보조 인덱스(Secondary Index or Non-Clustered Index)
  - Primary Key가 아닌 다른 컬럼에 대해 생성한 인덱스
  - 해당 컬럼으로 빠르게 검색하기 위한 추가적인 인덱스 구조가 별도로 만들어짐

:::
