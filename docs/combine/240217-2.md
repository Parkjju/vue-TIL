---
title: Combine - Publisher
tags: ['Swift', 'Combine']
---

## Publisher - Overview

퍼블리셔는 시간에 따라 방출하는 일련의 값들을 선언한다. 이렇게 방출된 값들은 하나 이상의 구독자에게 전달할 수 있다.

구독자의 `Input`과 `Failure`타입은 퍼블리셔에 선언된 `Output`, `Failure`타입과 일치해야 한다. 퍼블리셔는 구독자의 구독을 받아들이기 위해 `receive(subscriber:)` 메서드를 내부적으로 구현한다. `Publisher` 중첩 구조체를 살펴보면 내부에 `receive` 함수 타입이 정의된 것을 볼 수 있다.

퍼블리셔는 아래의 메서드들을 구독자에게 호출할 수 있다.

1. `receive(subscription:)`: 구독 요청을 승인하고 `Subscription` 인스턴스를 반환한다. 구독자는 `Subscription` 인스턴스를 통해 퍼블리셔에게 값을 요구하고 값의 방출을 취소할 수 있다.
2. `receive(_:)`: 퍼블리셔로부터 하나의 값을 구독자에게 전달한다.
3. `receive(completion:)`: 구독자에게 값의 방출이 끝났음을 알린다.

모든 퍼블리셔는 `Publisher`프로토콜 채택에 따라 `receive` 메서드를 반드시 구현해야 한다.

`Publishers` 열거형 내부 구현을 살펴보면 수 많은 퍼블리셔들이 정의되어 있는 것을 볼 수 있다. 이는 퍼블리셔 체이닝을 위해 오퍼레이터로 사용될 목적으로 만들어진 것이다. 예를 들어 `map` 오퍼레이터의 경우 `Publishers.Map`클래스의 인스턴스를 리턴하도록 구현되어 있다.

:::tip Publisher vs AsyncSequence

퍼블리셔와 스위프트 표준 라이브러리의 `AsyncSequence`는 시간에 따라 값을 방출한다는 점에서 동일하지만 퍼블리셔는 구독자를 통해 퍼블리셔로부터 값을 요청하는 반면 `AsyncSequence`는 `for-await-in`을 통해 방출되는 값들을 순회한다.

둘다 모두 필터링 및 매핑 관련 연산자를 제공한다.

```swift
let endpointURL = URL(string: "https://zeddios.tistory.com")!
let lineCount = endpointURL.lines.map { $0.count } ✅ // AsyncSequence 인스턴스의 map 연산자
do {
    for try await line in lineCount {
        print(line)
    }
} catch {

}
// 출처: https://zeddios.tistory.com/1339 [ZeddiOS:티스토리]
```

컴바인에서는 `AsyncSequence`에서 제공하지 않는 시간 기반의 오퍼레이터 `debounce`, `throttle`을 추가로 제공하며 퍼블리셔 간 결합 오퍼레이터인 `merge(with:)`, `combineLatest(_: _:)` 연산자들도 제공한다.

`AsyncSequence`와 컴바인의 퍼블리셔를 브릿징하기 위해서는 퍼블리셔에서 방출하는 값들을 `AsyncSequence`로 노출시켜 구독자를 통한 값의 처리방법 대신 `for-await-in`으로 순회할 수 있다.

:::

퍼블리셔 프로토콜을 채택하여 직접 정의하는 대신 컴바인에서 제공하는 몇가지 타입을 활용하면 커스텀 퍼블리셔를 쉽게 정의할 수 있다. `PassThroughSubject`와 같은 `Subject` 하위클래스 타입을 사용하면 된다. (`PassThroughSubject`는 RxSwift에서 `PublishSubject`, `CurrentValueSubject`는 `BehaviorSubject`와 동일하다.)

`@Published` 프로퍼티 래퍼를 사용하면 속성의 값이 변할때마다 값을 방출하는 퍼블리셔를 쉽게 정의할 수도 있다.

## Publisher - Output, Failure

Output은 퍼블리셔로부터 방출되는 값의 타입을 의미한다. `Failure`는 퍼블리셔가 방출할 수 있는 에러의 타입을 의미한다. 퍼블리셔가 에러를 방출하지 않을 경우 `Never`를 사용한다.

## Reference

1. [Zeddios - AsyncSequence](https://zeddios.tistory.com/1339)
2. [Apple Document - Publisher](https://developer.apple.com/documentation/combine/publisher)
3. [try code by Marin Todorov - subscribe(on:) vs receive(on:)](https://trycombine.com/posts/subscribe-on-receive-on/)
4. [Velog - subscribe(on:) VS. receive(on:)](https://velog.io/@ictechgy/Combine-subscribeon-VS.-receiveon)
