---
title: Swift - 피커뷰
---

## 이미지 피커

사용자 핸드폰 앨범에 접근하여 사진 및 미디어를 불러와야 하는 경우가 있다. 이때 사용하는 것이 `PHPickerViewController`이다.

:::warning PHPickerView 호환성
이미지 피커뷰를 구현하는 방식이 iOS 14버전 이후로 PHPickerView로 변경되면서 이전 버전에서는 에러가 발생하니 주의하자.
:::

피커뷰를 사용하기 위한 과정은 아래와 같다.

1. `PhotosUI`를 임포트한다.
2. 뷰 컨트롤러의 확장에 `PHPickerViewControllerDelegate` 델리게이트 프로토콜을 채택한다.
3. 위 프로토콜의 필수 구현 함수인 `func picker(_ picker: PHPickerViewController, didFinishPicking results: [PHPickerResult])`를 구현한다. (구현 코드는 아래에서 정리)
4. 피커뷰 컨트롤러를 세팅한다.

피커뷰 컨트롤러의 프로토콜 함수 코드는 아래와 같다.

```swift
func picker(_ picker: PHPickerViewController, didFinishPicking results: [PHPickerResult]) {

    // 피커뷰 사진 선택 환료 및 취소시 dismiss
    picker.dismiss(animated: true)

    // 아이템 프로바이더 객체 가져오기
    let itemProvider = results.first?.itemProvider

    // itemProvider가 nil이 아니고
    // itemProvider가 UIImage 메타타입에 대해 오브젝트 로딩이 가능하면
    // 아래 동작들을 실행한다.
    if let itemProvider = itemProvider, itemProvider.canLoadObject(ofClass: UIImage.self){

        // 아이템 프로바이더에서 불러온 객체를 로드한다.
        // 콜백 형태로 받는다.
        // 디스패치큐에 원하는 객체로 데이터 등록을 하는 코드를 삽입해놓으면 OS가 자동으로 해당 코드를 실행한다.
        itemProvider.loadObject(ofClass: UIImage.self){ (image, error) in
            DispatchQueue.main.async{
                // image파라미터의 타입은 NSItemProviderReading? 이므로
                // 타입 다운캐스팅이 필요하다.
                self.detailView.profileImageView.image = image as? UIImage
            }
        }
    } else {
        print("Load Error")
    }
}
```

아이템 프로바이더 객체는 객체 드래그앤드롭 및 복사 붙여넣기 시 파일을 중개해주는 객체라고 한다.

> An item provider for conveying data or a file between processes during drag-and-drop or copy/paste activities, or from a host app to an app extension.

피커뷰를 세팅하는 코드는 아래와 같다.

```swift
func setupImagePicker(){
    var configuration = PHPickerConfiguration()
    configuration.selectionLimit = 0
    configuration.filter = .any(of: [.images, .videos])

    let picker = PHPickerViewController(configuration: configuration)

    picker.delegate = self
    present(picker, animated: true)
}
```

## Reference

1. [앨런 Swift 문법 마스터스쿨](https://www.inflearn.com/course/%EC%8A%A4%EC%9C%84%ED%94%84%ED%8A%B8-%EB%AC%B8%EB%B2%95-%EB%A7%88%EC%8A%A4%ED%84%B0-%EC%8A%A4%EC%BF%A8-%EC%95%B1%EB%A7%8C%EB%93%A4%EA%B8%B0/dashboard)
2. [iOS) PHPicker iOS 14+](https://gyuios.tistory.com/131)
